


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > InternedIRI</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.eclipse.rdf4j.model.base</a>
</div>

<h1>Coverage Summary for Class: InternedIRI (org.eclipse.rdf4j.model.base)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">InternedIRI</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    66.7%
  </span>
  <span class="absValue">
    (8/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    57.1%
  </span>
  <span class="absValue">
    (8/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    45.5%
  </span>
  <span class="absValue">
    (20/44)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*******************************************************************************
&nbsp; * Copyright (c) 2022 Eclipse RDF4J contributors.
&nbsp; *
&nbsp; * All rights reserved. This program and the accompanying materials
&nbsp; * are made available under the terms of the Eclipse Distribution License v1.0
&nbsp; * which accompanies this distribution, and is available at
&nbsp; * http://www.eclipse.org/org/documents/edl-v10.php.
&nbsp; *
&nbsp; * SPDX-License-Identifier: BSD-3-Clause
&nbsp; *******************************************************************************/
&nbsp;
&nbsp;package org.eclipse.rdf4j.model.base;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.io.ObjectInputStream;
&nbsp;import java.io.ObjectOutputStream;
&nbsp;import java.lang.reflect.Field;
&nbsp;
&nbsp;import org.eclipse.rdf4j.common.annotation.InternalUseOnly;
&nbsp;import org.eclipse.rdf4j.model.IRI;
&nbsp;import org.eclipse.rdf4j.model.Value;
&nbsp;
&nbsp;/**
&nbsp; * An IRI implementation that interns the stringValue so that two objects can be compared by their stringValue
&nbsp; * reference. Must only be used for IRIs that are effectively ´public static final´ and only for a very limited number
&nbsp; * of objects because string interning affects the GC root set
&nbsp; * (https://shipilev.net/jvm/anatomy-quarks/10-string-intern/).
&nbsp; *
&nbsp; */
<b class="fc">&nbsp;@InternalUseOnly</b>
&nbsp;public final class InternedIRI implements IRI {
&nbsp;	private static final long serialVersionUID = 169243429049169159L;
&nbsp;
&nbsp;	private final String namespace;
&nbsp;	private final String localName;
&nbsp;	private final String stringValue;
&nbsp;	private final int hashCode;
&nbsp;
<b class="fc">&nbsp;	public InternedIRI(String namespace, String localName) {</b>
<b class="fc">&nbsp;		this.namespace = namespace;</b>
<b class="fc">&nbsp;		this.localName = localName;</b>
<b class="fc">&nbsp;		this.stringValue = namespace.concat(localName).intern();</b>
<b class="fc">&nbsp;		this.hashCode = stringValue.hashCode();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String stringValue() {
<b class="fc">&nbsp;		return stringValue;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String getNamespace() {
<b class="fc">&nbsp;		return namespace;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String getLocalName() {
<b class="fc">&nbsp;		return localName;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String toString() {
<b class="fc">&nbsp;		return stringValue;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public boolean equals(Object o) {
<b class="fc">&nbsp;		if (this == o) {</b>
<b class="fc">&nbsp;			return true;</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		if (o instanceof InternedIRI) {</b>
&nbsp;			// Because the stringValue is interned we can simply compare the reference.
<b class="pc">&nbsp;			return stringValue == ((InternedIRI) o).stringValue;</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		if (o instanceof Value) {</b>
<b class="fc">&nbsp;			Value value = (Value) o;</b>
<b class="pc">&nbsp;			if (value.isIRI()) {</b>
<b class="fc">&nbsp;				return stringValue.equals(value.stringValue());</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		return false;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public int hashCode() {
<b class="fc">&nbsp;		return hashCode;</b>
&nbsp;	}
&nbsp;
&nbsp;	private void writeObject(ObjectOutputStream out) throws IOException {
<b class="nc">&nbsp;		out.writeInt(hashCode);</b>
<b class="nc">&nbsp;		out.writeUTF(namespace);</b>
<b class="nc">&nbsp;		out.writeUTF(localName);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void readObject(ObjectInputStream in) throws ClassNotFoundException, IOException {
<b class="nc">&nbsp;		int hashCode = in.readInt();</b>
<b class="nc">&nbsp;		String namespace = in.readUTF();</b>
<b class="nc">&nbsp;		String localName = in.readUTF();</b>
&nbsp;
&nbsp;		// Deserialization in Java typically uses Unsafe to set final fields, we need to use reflection.
<b class="nc">&nbsp;		writeToPrivateFinalField(namespace, &quot;namespace&quot;);</b>
<b class="nc">&nbsp;		writeToPrivateFinalField(localName, &quot;localName&quot;);</b>
<b class="nc">&nbsp;		writeToPrivateFinalField(hashCode, &quot;hashCode&quot;);</b>
&nbsp;
&nbsp;		// The main reason we need a custom deserialization is that we need to intern the stringValue field.
<b class="nc">&nbsp;		String stringValue = (namespace + localName).intern();</b>
<b class="nc">&nbsp;		writeToPrivateFinalField(stringValue, &quot;stringValue&quot;);</b>
<b class="nc">&nbsp;		assert stringValue.hashCode() == hashCode;</b>
&nbsp;	}
&nbsp;
&nbsp;	private void writeToPrivateFinalField(String value, String fieldName) {
&nbsp;		try {
<b class="nc">&nbsp;			Field field = InternedIRI.class.getDeclaredField(fieldName);</b>
<b class="nc">&nbsp;			field.setAccessible(true);</b>
<b class="nc">&nbsp;			field.set(this, value);</b>
<b class="nc">&nbsp;		} catch (NoSuchFieldException | IllegalAccessException e) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(e);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private void writeToPrivateFinalField(int value, String fieldName) {
&nbsp;		try {
<b class="nc">&nbsp;			Field field = InternedIRI.class.getDeclaredField(fieldName);</b>
<b class="nc">&nbsp;			field.setAccessible(true);</b>
<b class="nc">&nbsp;			field.set(this, value);</b>
<b class="nc">&nbsp;		} catch (NoSuchFieldException | IllegalAccessException e) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(e);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-09-18 08:58</div>
</div>
</body>
</html>
