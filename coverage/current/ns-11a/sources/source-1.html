


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ComplexSPARQLQueryTest</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.eclipse.rdf4j.testsuite.query.parser.sparql</a>
</div>

<h1>Coverage Summary for Class: ComplexSPARQLQueryTest (org.eclipse.rdf4j.testsuite.query.parser.sparql)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ComplexSPARQLQueryTest</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/99)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/484)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1278)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ComplexSPARQLQueryTest$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/101)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/484)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1280)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*******************************************************************************
&nbsp; * Copyright (c) 2015 Eclipse RDF4J contributors, Aduna, and others.
&nbsp; *
&nbsp; * All rights reserved. This program and the accompanying materials
&nbsp; * are made available under the terms of the Eclipse Distribution License v1.0
&nbsp; * which accompanies this distribution, and is available at
&nbsp; * http://www.eclipse.org/org/documents/edl-v10.php.
&nbsp; *
&nbsp; * SPDX-License-Identifier: BSD-3-Clause
&nbsp; *******************************************************************************/
&nbsp;package org.eclipse.rdf4j.testsuite.query.parser.sparql;
&nbsp;
&nbsp;import static org.assertj.core.api.Assertions.assertThat;
&nbsp;import static org.eclipse.rdf4j.model.util.Statements.statement;
&nbsp;import static org.eclipse.rdf4j.model.util.Values.iri;
&nbsp;import static org.eclipse.rdf4j.model.util.Values.literal;
&nbsp;import static org.junit.Assert.assertEquals;
&nbsp;import static org.junit.Assert.assertFalse;
&nbsp;import static org.junit.Assert.assertNotEquals;
&nbsp;import static org.junit.Assert.assertNotNull;
&nbsp;import static org.junit.Assert.assertNull;
&nbsp;import static org.junit.Assert.assertTrue;
&nbsp;import static org.junit.Assert.fail;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.io.InputStream;
&nbsp;import java.io.StringReader;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.stream.Stream;
&nbsp;
&nbsp;import org.eclipse.rdf4j.model.BNode;
&nbsp;import org.eclipse.rdf4j.model.IRI;
&nbsp;import org.eclipse.rdf4j.model.Literal;
&nbsp;import org.eclipse.rdf4j.model.Model;
&nbsp;import org.eclipse.rdf4j.model.Resource;
&nbsp;import org.eclipse.rdf4j.model.Statement;
&nbsp;import org.eclipse.rdf4j.model.Value;
&nbsp;import org.eclipse.rdf4j.model.ValueFactory;
&nbsp;import org.eclipse.rdf4j.model.base.CoreDatatype;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.DCAT;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.DCTERMS;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.FOAF;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.OWL;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.RDF;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.RDFS;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.SESAME;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.XSD;
&nbsp;import org.eclipse.rdf4j.query.AbstractTupleQueryResultHandler;
&nbsp;import org.eclipse.rdf4j.query.Binding;
&nbsp;import org.eclipse.rdf4j.query.BindingSet;
&nbsp;import org.eclipse.rdf4j.query.GraphQuery;
&nbsp;import org.eclipse.rdf4j.query.GraphQueryResult;
&nbsp;import org.eclipse.rdf4j.query.QueryEvaluationException;
&nbsp;import org.eclipse.rdf4j.query.QueryLanguage;
&nbsp;import org.eclipse.rdf4j.query.QueryResults;
&nbsp;import org.eclipse.rdf4j.query.TupleQuery;
&nbsp;import org.eclipse.rdf4j.query.TupleQueryResult;
&nbsp;import org.eclipse.rdf4j.query.impl.MapBindingSet;
&nbsp;import org.eclipse.rdf4j.query.impl.SimpleBinding;
&nbsp;import org.eclipse.rdf4j.query.impl.SimpleDataset;
&nbsp;import org.eclipse.rdf4j.repository.Repository;
&nbsp;import org.eclipse.rdf4j.repository.RepositoryConnection;
&nbsp;import org.eclipse.rdf4j.repository.RepositoryException;
&nbsp;import org.eclipse.rdf4j.rio.RDFFormat;
&nbsp;import org.eclipse.rdf4j.rio.RDFParseException;
&nbsp;import org.eclipse.rdf4j.rio.Rio;
&nbsp;import org.eclipse.rdf4j.testsuite.query.parser.sparql.manifest.SPARQL11ManifestTest;
&nbsp;import org.eclipse.rdf4j.testsuite.sparql.RepositorySPARQLComplianceTestSuite;
&nbsp;import org.junit.After;
&nbsp;import org.junit.AfterClass;
&nbsp;import org.junit.Before;
&nbsp;import org.junit.BeforeClass;
&nbsp;import org.junit.Test;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;/**
&nbsp; * A set of compliance tests on SPARQL query functionality which can not be easily executed using the
&nbsp; * {@link SPARQL11ManifestTest} format. This includes tests on queries with non-deterministic output (e.g.
&nbsp; * GROUP_CONCAT).
&nbsp; *
&nbsp; * @deprecated use {@link RepositorySPARQLComplianceTestSuite} instead.
&nbsp; * @author Jeen Broekstra
&nbsp; */
&nbsp;@Deprecated(since = &quot;4.0.2&quot;, forRemoval = true)
<b class="nc">&nbsp;public abstract class ComplexSPARQLQueryTest {</b>
&nbsp;
&nbsp;	@BeforeClass
&nbsp;	public static void setUpClass() {
<b class="nc">&nbsp;		System.setProperty(&quot;org.eclipse.rdf4j.repository.debug&quot;, &quot;true&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	@AfterClass
&nbsp;	public static void afterClass() throws Exception {
<b class="nc">&nbsp;		System.setProperty(&quot;org.eclipse.rdf4j.repository.debug&quot;, &quot;false&quot;);</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	protected final Logger logger = LoggerFactory.getLogger(this.getClass());</b>
&nbsp;
&nbsp;	private Repository rep;
&nbsp;
&nbsp;	protected RepositoryConnection conn;
&nbsp;
&nbsp;	protected ValueFactory f;
&nbsp;
&nbsp;	protected static final String EX_NS = &quot;http://example.org/&quot;;
&nbsp;
&nbsp;	private IRI bob;
&nbsp;
&nbsp;	private IRI alice;
&nbsp;
&nbsp;	private IRI mary;
&nbsp;
&nbsp;	/**
&nbsp;	 * @throws java.lang.Exception
&nbsp;	 */
&nbsp;	@Before
&nbsp;	public void setUp() throws Exception {
<b class="nc">&nbsp;		logger.debug(&quot;setting up test&quot;);</b>
<b class="nc">&nbsp;		this.rep = newRepository();</b>
&nbsp;
<b class="nc">&nbsp;		f = rep.getValueFactory();</b>
<b class="nc">&nbsp;		conn = rep.getConnection();</b>
&nbsp;
<b class="nc">&nbsp;		conn.clear(); // clear existing data from repo</b>
&nbsp;
<b class="nc">&nbsp;		bob = f.createIRI(EX_NS, &quot;bob&quot;);</b>
<b class="nc">&nbsp;		alice = f.createIRI(EX_NS, &quot;alice&quot;);</b>
<b class="nc">&nbsp;		mary = f.createIRI(EX_NS, &quot;mary&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		logger.debug(&quot;test setup complete.&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @throws java.lang.Exception
&nbsp;	 */
&nbsp;	@After
&nbsp;	public void tearDown() throws Exception {
&nbsp;		try {
<b class="nc">&nbsp;			if (conn != null) {</b>
<b class="nc">&nbsp;				conn.close();</b>
&nbsp;			}
&nbsp;		} finally {
<b class="nc">&nbsp;			if (rep != null) {</b>
<b class="nc">&nbsp;				rep.shutDown();</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testNullContext1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot; SELECT * &quot; +</b>
&nbsp;				&quot; FROM DEFAULT &quot; +
&nbsp;				&quot; WHERE { ?s ?p ?o } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
<b class="nc">&nbsp;				Resource s = (Resource) bs.getValue(&quot;s&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertNotNull(s);</b>
<b class="nc">&nbsp;				assertNotEquals(bob, s); // should not be present in default</b>
&nbsp;				// graph
<b class="nc">&nbsp;				assertNotEquals(alice, s); // should not be present in</b>
&nbsp;				// default
&nbsp;				// graph
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2373SubselectOptional() {
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL,</b>
&nbsp;				&quot;insert data {&quot; + &quot;&lt;u:1&gt; &lt;u:r&gt; &lt;u:subject&gt; .&quot; + &quot;&lt;u:1&gt; &lt;u:v&gt; 1 .&quot; + &quot;&lt;u:1&gt; &lt;u:x&gt; &lt;u:x1&gt; .&quot;
&nbsp;						+ &quot;&lt;u:2&gt; &lt;u:r&gt; &lt;u:subject&gt; .&quot; + &quot;&lt;u:2&gt; &lt;u:v&gt; 2 .&quot; + &quot;&lt;u:2&gt; &lt;u:x&gt; &lt;u:x2&gt; .&quot;
&nbsp;						+ &quot;&lt;u:3&gt; &lt;u:r&gt; &lt;u:subject&gt; .&quot; + &quot;&lt;u:3&gt; &lt;u:v&gt; 3 .&quot; + &quot;&lt;u:3&gt; &lt;u:x&gt; &lt;u:x3&gt; .&quot;
&nbsp;						+ &quot;&lt;u:4&gt; &lt;u:r&gt; &lt;u:subject&gt; .&quot; + &quot;&lt;u:4&gt; &lt;u:v&gt; 4 .&quot; + &quot;&lt;u:4&gt; &lt;u:x&gt; &lt;u:x4&gt; .&quot;
&nbsp;						+ &quot;&lt;u:5&gt; &lt;u:r&gt; &lt;u:subject&gt; .&quot; + &quot;&lt;u:5&gt; &lt;u:v&gt; 5 .&quot; + &quot;&lt;u:5&gt; &lt;u:x&gt; &lt;u:x5&gt; .&quot; + &quot;}&quot;)
<b class="nc">&nbsp;				.execute();</b>
&nbsp;
<b class="nc">&nbsp;		String qb = &quot;select ?x { \n&quot; +</b>
&nbsp;				&quot; { select ?v { ?v &lt;u:r&gt; &lt;u:subject&gt; filter (?v = &lt;u:1&gt;) } }.\n&quot; +
&nbsp;				&quot;  optional {  select ?val { ?v &lt;u:v&gt; ?val .} }\n&quot; +
&nbsp;				&quot;  ?v &lt;u:x&gt; ?x \n&quot; +
&nbsp;				&quot;}\n&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, qb);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertTrue(&quot;The query should return a result&quot;, result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet b = result.next();</b>
<b class="nc">&nbsp;			assertTrue(&quot;?x is from the mandatory part of the query and should be bound&quot;, b.hasBinding(&quot;x&quot;));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2154SubselectOptional() {
&nbsp;
<b class="nc">&nbsp;		String ub = &quot;insert data { \n&quot; +</b>
&nbsp;				&quot; &lt;urn:s1&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s2&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s3&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s4&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s5&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s6&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s7&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s8&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s9&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s10&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s11&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s12&gt; a &lt;urn:C&gt; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s1&gt; &lt;urn:p&gt; \&quot;01\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s2&gt; &lt;urn:p&gt; \&quot;02\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s3&gt; &lt;urn:p&gt; \&quot;03\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s4&gt; &lt;urn:p&gt; \&quot;04\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s5&gt; &lt;urn:p&gt; \&quot;05\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s6&gt; &lt;urn:p&gt; \&quot;06\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s7&gt; &lt;urn:p&gt; \&quot;07\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s8&gt; &lt;urn:p&gt; \&quot;08\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s9&gt; &lt;urn:p&gt; \&quot;09\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s10&gt; &lt;urn:p&gt; \&quot;10\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s11&gt; &lt;urn:p&gt; \&quot;11\&quot; .  \n&quot; +
&nbsp;				&quot; &lt;urn:s12&gt; &lt;urn:p&gt; \&quot;12\&quot; .  \n&quot; +
&nbsp;				&quot;} \n&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, ub).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String qb = &quot;SELECT ?s ?label\n&quot; +</b>
&nbsp;				&quot;WHERE { \n&quot; +
&nbsp;				&quot; 	  ?s a &lt;urn:C&gt; \n .\n&quot; +
&nbsp;				&quot; 	  OPTIONAL  { {SELECT ?label  WHERE { \n&quot; +
&nbsp;				&quot;                     ?s &lt;urn:p&gt; ?label . \n&quot; +
&nbsp;				&quot;   	      } ORDER BY ?label LIMIT 2 \n&quot; +
&nbsp;				&quot;		    }\n&quot; +
&nbsp;				&quot;       }\n&quot; +
&nbsp;				&quot;}\n&quot; +
&nbsp;				&quot;ORDER BY ?s\n&quot; +
&nbsp;				&quot;LIMIT 10 \n&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, qb);</b>
<b class="nc">&nbsp;		try (TupleQueryResult evaluate = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertTrue(&quot;The query should return a result&quot;, evaluate.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			List&lt;BindingSet&gt; result = QueryResults.asList(evaluate);</b>
<b class="nc">&nbsp;			assertEquals(10, result.size());</b>
<b class="nc">&nbsp;			for (BindingSet bs : result) {</b>
<b class="nc">&nbsp;				Literal label = (Literal) bs.getValue(&quot;label&quot;);</b>
<b class="nc">&nbsp;				assertTrue(&quot;wrong label value (expected &#39;01&#39; or &#39;02&#39;, but got &#39;&quot; + label.stringValue() + &quot;&#39;)&quot;,</b>
<b class="nc">&nbsp;						label.stringValue().equals(&quot;01&quot;) || label.stringValue().equals(&quot;02&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testNullContext2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT * &quot; +
&nbsp;				&quot; FROM rdf4j:nil &quot; +
&nbsp;				&quot; WHERE { ?s ?p ?o } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
<b class="nc">&nbsp;				Resource s = (Resource) bs.getValue(&quot;s&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertNotNull(s);</b>
<b class="nc">&nbsp;				assertNotEquals(bob, s); // should not be present in default</b>
&nbsp;				// graph
<b class="nc">&nbsp;				assertNotEquals(alice, s); // should not be present in</b>
&nbsp;				// default
&nbsp;				// graph
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSesameNilAsGraph() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT * &quot; +
&nbsp;				&quot; WHERE { GRAPH rdf4j:nil { ?s ?p ?o } } &quot;;
&nbsp;//		query.append(&quot; WHERE { ?s ?p ?o } &quot;);
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
&nbsp;		try {
<b class="nc">&nbsp;			List&lt;BindingSet&gt; result = QueryResults.asList(tq.evaluate());</b>
&nbsp;
&nbsp;			// nil graph should not be empty
<b class="nc">&nbsp;			assertThat(result.size()).isGreaterThan(1);</b>
&nbsp;
<b class="nc">&nbsp;			for (BindingSet bs : result) {</b>
<b class="nc">&nbsp;				Resource s = (Resource) bs.getValue(&quot;s&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertNotNull(s);</b>
<b class="nc">&nbsp;				assertThat(s).withFailMessage(&quot;%s should not be present in nil graph&quot;, bob).isNotEqualTo(bob);</b>
<b class="nc">&nbsp;				assertThat(s).withFailMessage(&quot;%s should not be present in nil graph&quot;, alice).isNotEqualTo(alice);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeA() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ex:a&quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory f = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI a = f.createIRI(&quot;http://example.org/a&quot;);</b>
<b class="nc">&nbsp;		IRI p = f.createIRI(&quot;http://example.org/p&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
<b class="nc">&nbsp;			Set&lt;Value&gt; objects = result.filter(a, p, null).objects();</b>
<b class="nc">&nbsp;			assertNotNull(objects);</b>
<b class="nc">&nbsp;			for (Value object : objects) {</b>
<b class="nc">&nbsp;				if (object instanceof BNode) {</b>
<b class="nc">&nbsp;					assertTrue(result.contains((Resource) object, null, null));</b>
<b class="nc">&nbsp;					assertEquals(2, result.filter((Resource) object, null, null).size());</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeAWhere() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ?x WHERE {?x rdfs:label \&quot;a\&quot;. } &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory f = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI a = f.createIRI(&quot;http://example.org/a&quot;);</b>
<b class="nc">&nbsp;		IRI p = f.createIRI(&quot;http://example.org/p&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
<b class="nc">&nbsp;			Set&lt;Value&gt; objects = result.filter(a, p, null).objects();</b>
<b class="nc">&nbsp;			assertNotNull(objects);</b>
<b class="nc">&nbsp;			for (Value object : objects) {</b>
<b class="nc">&nbsp;				if (object instanceof BNode) {</b>
<b class="nc">&nbsp;					assertTrue(result.contains((Resource) object, null, null));</b>
<b class="nc">&nbsp;					assertEquals(2, result.filter((Resource) object, null, null).size());</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeWhere() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ?x WHERE {?x rdfs:label ?y . } &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI a = vf.createIRI(&quot;http://example.org/a&quot;);</b>
<b class="nc">&nbsp;		IRI b = vf.createIRI(&quot;http://example.org/b&quot;);</b>
<b class="nc">&nbsp;		IRI c = vf.createIRI(&quot;http://example.org/c&quot;);</b>
<b class="nc">&nbsp;		IRI e = vf.createIRI(&quot;http://example.org/e&quot;);</b>
<b class="nc">&nbsp;		IRI f = vf.createIRI(&quot;http://example.org/f&quot;);</b>
<b class="nc">&nbsp;		IRI p = vf.createIRI(&quot;http://example.org/p&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
<b class="nc">&nbsp;			assertTrue(result.contains(a, p, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(b, RDFS.LABEL, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(c, RDFS.LABEL, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, p, b));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(e, RDFS.LABEL, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, p, e));</b>
<b class="nc">&nbsp;			assertFalse(result.contains(f, null, null));</b>
<b class="nc">&nbsp;			Set&lt;Value&gt; objects = result.filter(a, p, null).objects();</b>
<b class="nc">&nbsp;			assertNotNull(objects);</b>
<b class="nc">&nbsp;			for (Value object : objects) {</b>
<b class="nc">&nbsp;				if (object instanceof BNode) {</b>
<b class="nc">&nbsp;					assertTrue(result.contains((Resource) object, null, null));</b>
<b class="nc">&nbsp;					assertEquals(2, result.filter((Resource) object, null, null).size());</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeB() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ex:b&quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory f = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI b = f.createIRI(&quot;http://example.org/b&quot;);</b>
<b class="nc">&nbsp;		IRI p = f.createIRI(&quot;http://example.org/p&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
<b class="nc">&nbsp;			Set&lt;Resource&gt; subjects = result.filter(null, p, b).subjects();</b>
<b class="nc">&nbsp;			assertNotNull(subjects);</b>
<b class="nc">&nbsp;			for (Value subject : subjects) {</b>
<b class="nc">&nbsp;				if (subject instanceof BNode) {</b>
<b class="nc">&nbsp;					assertTrue(result.contains(null, null, subject));</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeD() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ex:d&quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory f = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI d = f.createIRI(&quot;http://example.org/d&quot;);</b>
<b class="nc">&nbsp;		IRI p = f.createIRI(&quot;http://example.org/p&quot;);</b>
<b class="nc">&nbsp;		IRI e = f.createIRI(&quot;http://example.org/e&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, p, e));</b>
<b class="nc">&nbsp;			assertFalse(result.contains(e, null, null));</b>
<b class="nc">&nbsp;			Set&lt;Value&gt; objects = result.filter(d, p, null).objects();</b>
<b class="nc">&nbsp;			assertNotNull(objects);</b>
<b class="nc">&nbsp;			for (Value object : objects) {</b>
<b class="nc">&nbsp;				if (object instanceof BNode) {</b>
<b class="nc">&nbsp;					Set&lt;Value&gt; childObjects = result.filter((BNode) object, null, null).objects();</b>
<b class="nc">&nbsp;					assertNotNull(childObjects);</b>
<b class="nc">&nbsp;					for (Value childObject : childObjects) {</b>
<b class="nc">&nbsp;						if (childObject instanceof BNode) {</b>
<b class="nc">&nbsp;							assertTrue(result.contains((BNode) childObject, null, null));</b>
&nbsp;						}
<b class="nc">&nbsp;					}</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeF() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-describe.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE ex:f&quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI f = vf.createIRI(&quot;http://example.org/f&quot;);</b>
<b class="nc">&nbsp;		IRI p = vf.createIRI(&quot;http://example.org/p&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertEquals(4, result.size());</b>
<b class="nc">&nbsp;			Set&lt;Value&gt; objects = result.filter(f, p, null).objects();</b>
<b class="nc">&nbsp;			assertNotNull(objects);</b>
<b class="nc">&nbsp;			for (Value object : objects) {</b>
<b class="nc">&nbsp;				if (object instanceof BNode) {</b>
<b class="nc">&nbsp;					Set&lt;Value&gt; childObjects = result.filter((BNode) object, null, null).objects();</b>
<b class="nc">&nbsp;					assertNotNull(childObjects);</b>
<b class="nc">&nbsp;					for (Value childObject : childObjects) {</b>
<b class="nc">&nbsp;						if (childObject instanceof BNode) {</b>
<b class="nc">&nbsp;							assertTrue(result.contains((BNode) childObject, null, null));</b>
&nbsp;						}
<b class="nc">&nbsp;					}</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeMultipleA() {
<b class="nc">&nbsp;		String update = &quot;insert data { &lt;urn:1&gt; &lt;urn:p1&gt; &lt;urn:v&gt; . [] &lt;urn:blank&gt; &lt;urn:1&gt; . &lt;urn:2&gt; &lt;urn:p2&gt; &lt;urn:3&gt; . } &quot;;</b>
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, update).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE &lt;urn:1&gt; &lt;urn:2&gt; &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI urn1 = vf.createIRI(&quot;urn:1&quot;);</b>
<b class="nc">&nbsp;		IRI p1 = vf.createIRI(&quot;urn:p1&quot;);</b>
<b class="nc">&nbsp;		IRI p2 = vf.createIRI(&quot;urn:p2&quot;);</b>
<b class="nc">&nbsp;		IRI urn2 = vf.createIRI(&quot;urn:2&quot;);</b>
<b class="nc">&nbsp;		IRI blank = vf.createIRI(&quot;urn:blank&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, p1, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, blank, urn1));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn2, p2, null));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeMultipleB() {
<b class="nc">&nbsp;		String update = &quot;insert data { &lt;urn:1&gt; &lt;urn:p1&gt; &lt;urn:v&gt; . &lt;urn:1&gt; &lt;urn:blank&gt; [] . &lt;urn:2&gt; &lt;urn:p2&gt; &lt;urn:3&gt; . } &quot;;</b>
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, update).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE &lt;urn:1&gt; &lt;urn:2&gt; &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI urn1 = vf.createIRI(&quot;urn:1&quot;);</b>
<b class="nc">&nbsp;		IRI p1 = vf.createIRI(&quot;urn:p1&quot;);</b>
<b class="nc">&nbsp;		IRI p2 = vf.createIRI(&quot;urn:p2&quot;);</b>
<b class="nc">&nbsp;		IRI urn2 = vf.createIRI(&quot;urn:2&quot;);</b>
<b class="nc">&nbsp;		IRI blank = vf.createIRI(&quot;urn:blank&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, p1, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, blank, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn2, p2, null));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeMultipleC() {
<b class="nc">&nbsp;		String update = &quot;insert data { &lt;urn:1&gt; &lt;urn:p1&gt; &lt;urn:v&gt; . [] &lt;urn:blank&gt; &lt;urn:1&gt;. &lt;urn:1&gt; &lt;urn:blank&gt; [] . &lt;urn:2&gt; &lt;urn:p2&gt; &lt;urn:3&gt; . } &quot;;</b>
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, update).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE &lt;urn:1&gt; &lt;urn:2&gt; &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI urn1 = vf.createIRI(&quot;urn:1&quot;);</b>
<b class="nc">&nbsp;		IRI p1 = vf.createIRI(&quot;urn:p1&quot;);</b>
<b class="nc">&nbsp;		IRI p2 = vf.createIRI(&quot;urn:p2&quot;);</b>
<b class="nc">&nbsp;		IRI urn2 = vf.createIRI(&quot;urn:2&quot;);</b>
<b class="nc">&nbsp;		IRI blank = vf.createIRI(&quot;urn:blank&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, p1, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, blank, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, blank, urn1));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn2, p2, null));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testDescribeMultipleD() {
<b class="nc">&nbsp;		String update = &quot;insert data { &lt;urn:1&gt; &lt;urn:p1&gt; &lt;urn:v&gt; . [] &lt;urn:blank&gt; &lt;urn:1&gt;. &lt;urn:2&gt; &lt;urn:p2&gt; &lt;urn:3&gt; . [] &lt;urn:blank&gt; &lt;urn:2&gt; . &lt;urn:4&gt; &lt;urn:p2&gt; &lt;urn:3&gt; . &lt;urn:4&gt; &lt;urn:blank&gt; [] .} &quot;;</b>
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, update).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;DESCRIBE &lt;urn:1&gt; &lt;urn:2&gt; &lt;urn:4&gt; &quot;;
&nbsp;
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		IRI urn1 = vf.createIRI(&quot;urn:1&quot;);</b>
<b class="nc">&nbsp;		IRI p1 = vf.createIRI(&quot;urn:p1&quot;);</b>
<b class="nc">&nbsp;		IRI p2 = vf.createIRI(&quot;urn:p2&quot;);</b>
<b class="nc">&nbsp;		IRI urn2 = vf.createIRI(&quot;urn:2&quot;);</b>
<b class="nc">&nbsp;		IRI urn4 = vf.createIRI(&quot;urn:4&quot;);</b>
<b class="nc">&nbsp;		IRI blank = vf.createIRI(&quot;urn:blank&quot;);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = gq.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertTrue(result.contains(urn1, p1, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(null, blank, urn1));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn2, p2, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn4, p2, null));</b>
<b class="nc">&nbsp;			assertTrue(result.contains(urn4, blank, null));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testGroupByEmpty() {
&nbsp;		// see issue https://github.com/eclipse/rdf4j/issues/573
<b class="nc">&nbsp;		String query = &quot;select ?x where {?x ?p ?o} group by ?x&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(query);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testGroupConcatDistinct() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT (GROUP_CONCAT(DISTINCT ?l) AS ?concat)&quot; +
&nbsp;				&quot;WHERE { ex:groupconcat-test ?p ?l . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
<b class="nc">&nbsp;				Value concat = bs.getValue(&quot;concat&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertTrue(concat instanceof Literal);</b>
&nbsp;
<b class="nc">&nbsp;				String lexValue = ((Literal) concat).getLabel();</b>
&nbsp;
<b class="nc">&nbsp;				int occ = countCharOccurrences(lexValue, &#39;a&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;b&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;c&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;d&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSameTermRepeatInOptional() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT ?l ?opt1 ?opt2 &quot; +
&nbsp;				&quot; FROM ex:optional-sameterm-graph &quot; +
&nbsp;				&quot; WHERE { &quot; +
&nbsp;				&quot;          ?s ex:p ex:A ; &quot; +
&nbsp;				&quot;          { &quot; +
&nbsp;				&quot;              { &quot; +
&nbsp;				&quot;                 ?s ?p ?l .&quot; +
&nbsp;				&quot;                 FILTER(?p = rdfs:label) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;              OPTIONAL { &quot; +
&nbsp;				&quot;                 ?s ?p ?opt1 . &quot; +
&nbsp;				&quot;                 FILTER (?p = ex:prop1) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;              OPTIONAL { &quot; +
&nbsp;				&quot;                 ?s ?p ?opt2 . &quot; +
&nbsp;				&quot;                 FILTER (?p = ex:prop2) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;          }&quot; +
&nbsp;				&quot; } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				Value l = bs.getValue(&quot;l&quot;);</b>
<b class="nc">&nbsp;				assertTrue(l instanceof Literal);</b>
<b class="nc">&nbsp;				assertEquals(&quot;label&quot;, ((Literal) l).getLabel());</b>
&nbsp;
<b class="nc">&nbsp;				Value opt1 = bs.getValue(&quot;opt1&quot;);</b>
<b class="nc">&nbsp;				assertNull(opt1);</b>
&nbsp;
<b class="nc">&nbsp;				Value opt2 = bs.getValue(&quot;opt2&quot;);</b>
<b class="nc">&nbsp;				assertNull(opt2);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(1, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1121VarNamesInOptionals() throws Exception {
&nbsp;		// Verifying that variable names have no influence on order of optionals
&nbsp;		// in query. See SES-1121.
&nbsp;
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1121.trig&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		String query1 = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT DISTINCT *\n&quot; +
&nbsp;				&quot; WHERE { GRAPH ?g { \n&quot; +
&nbsp;				&quot;          OPTIONAL { ?var35 ex:p ?b . } \n &quot; +
&nbsp;				&quot;          OPTIONAL { ?b ex:q ?c . } \n &quot; +
&nbsp;				&quot;       } \n&quot; +
&nbsp;				&quot; } \n&quot;;
&nbsp;
<b class="nc">&nbsp;		String query2 = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT DISTINCT *\n&quot; +
&nbsp;				&quot; WHERE { GRAPH ?g { \n&quot; +
&nbsp;				&quot;          OPTIONAL { ?var35 ex:p ?b . } \n &quot; +
&nbsp;				&quot;          OPTIONAL { ?b ex:q ?var2 . } \n &quot; +
&nbsp;				&quot;       } \n&quot; +
&nbsp;				&quot; } \n&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq1 = conn.prepareTupleQuery(QueryLanguage.SPARQL, query1);</b>
<b class="nc">&nbsp;		TupleQuery tq2 = conn.prepareTupleQuery(QueryLanguage.SPARQL, query2);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result1 = tq1.evaluate(); TupleQueryResult result2 = tq2.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result1);</b>
<b class="nc">&nbsp;			assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;			List&lt;BindingSet&gt; qr1 = QueryResults.asList(result1);</b>
<b class="nc">&nbsp;			List&lt;BindingSet&gt; qr2 = QueryResults.asList(result2);</b>
&nbsp;
&nbsp;			// System.out.println(qr1);
&nbsp;			// System.out.println(qr2);
&nbsp;
&nbsp;			// if optionals are not kept in same order, query results will be
&nbsp;			// different size.
<b class="nc">&nbsp;			assertEquals(qr1.size(), qr2.size());</b>
&nbsp;
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1081SameTermWithValues() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1081.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;PREFIX ex: &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot; SELECT * \n&quot; +
&nbsp;				&quot; WHERE { \n &quot; +
&nbsp;				&quot;          ?s ex:p ?a . \n&quot; +
&nbsp;				&quot;          FILTER sameTerm(?a, ?e) \n &quot; +
&nbsp;				&quot;          VALUES ?e { ex:b } \n &quot; +
&nbsp;				&quot; } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
<b class="nc">&nbsp;				Value s = bs.getValue(&quot;s&quot;);</b>
<b class="nc">&nbsp;				Value a = bs.getValue(&quot;a&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertNotNull(s);</b>
<b class="nc">&nbsp;				assertNotNull(a);</b>
<b class="nc">&nbsp;				assertEquals(f.createIRI(&quot;http://example.org/a&quot;), s);</b>
<b class="nc">&nbsp;				assertEquals(f.createIRI(&quot;http://example.org/b&quot;), a);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(1, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1898LeftJoinSemantics1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1898.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;  PREFIX : &lt;http://example.org/&gt; &quot; +</b>
&nbsp;				&quot;  SELECT * WHERE { &quot; +
&nbsp;				&quot;    ?s :p1 ?v1 . &quot; +
&nbsp;				&quot;    OPTIONAL {?s :p2 ?v2 } .&quot; +
&nbsp;				&quot;     ?s :p3 ?v2 . &quot; +
&nbsp;				&quot;  } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		try (Stream&lt;BindingSet&gt; result = tq.evaluate().stream()) {</b>
<b class="nc">&nbsp;			long count = result.count();</b>
<b class="nc">&nbsp;			assertEquals(0, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1073InverseSymmetricPattern() {
<b class="nc">&nbsp;		IRI a = f.createIRI(&quot;http://example.org/a&quot;);</b>
<b class="nc">&nbsp;		IRI b1 = f.createIRI(&quot;http://example.org/b1&quot;);</b>
<b class="nc">&nbsp;		IRI b2 = f.createIRI(&quot;http://example.org/b2&quot;);</b>
<b class="nc">&nbsp;		IRI c1 = f.createIRI(&quot;http://example.org/c1&quot;);</b>
<b class="nc">&nbsp;		IRI c2 = f.createIRI(&quot;http://example.org/c2&quot;);</b>
<b class="nc">&nbsp;		IRI a2b = f.createIRI(&quot;http://example.org/a2b&quot;);</b>
<b class="nc">&nbsp;		IRI b2c = f.createIRI(&quot;http://example.org/b2c&quot;);</b>
<b class="nc">&nbsp;		conn.add(a, a2b, b1);</b>
<b class="nc">&nbsp;		conn.add(a, a2b, b2);</b>
<b class="nc">&nbsp;		conn.add(b1, b2c, c1);</b>
<b class="nc">&nbsp;		conn.add(b2, b2c, c2);</b>
<b class="nc">&nbsp;		String query = &quot;select * &quot;;</b>
<b class="nc">&nbsp;		query += &quot;where{ &quot;;</b>
<b class="nc">&nbsp;		query += &quot;?c1 ^&lt;http://example.org/b2c&gt;/^&lt;http://example.org/a2b&gt;/&lt;http://example.org/a2b&gt;/&lt;http://example.org/b2c&gt; ?c2 . &quot;;</b>
<b class="nc">&nbsp;		query += &quot; } &quot;;</b>
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (Stream&lt;BindingSet&gt; result = tq.evaluate().stream()) {</b>
<b class="nc">&nbsp;			long count = result.count();</b>
<b class="nc">&nbsp;			assertEquals(4, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1970CountDistinctWildcard() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1970.trig&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		String query = &quot;SELECT (COUNT(DISTINCT *) AS ?c) {?s ?p ?o }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet s = result.next();</b>
<b class="nc">&nbsp;			Literal count = (Literal) s.getValue(&quot;c&quot;);</b>
<b class="nc">&nbsp;			assertNotNull(count);</b>
&nbsp;
<b class="nc">&nbsp;			assertEquals(3, count.intValue());</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1685propPathSameVar() throws Exception {
<b class="nc">&nbsp;		final String queryStr = &quot;PREFIX : &lt;urn:&gt; SELECT ?x WHERE {?x :p+ ?x}&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		conn.add(new StringReader(&quot;@prefix : &lt;urn:&gt; . :a :p :b . :b :p :a .&quot;), &quot;&quot;, RDFFormat.TURTLE);</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery query = conn.prepareTupleQuery(QueryLanguage.SPARQL, queryStr);</b>
&nbsp;
<b class="nc">&nbsp;		try (Stream&lt;BindingSet&gt; result = query.evaluate().stream()) {</b>
<b class="nc">&nbsp;			long count = result.count();</b>
<b class="nc">&nbsp;			assertEquals(2, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2104ConstructBGPSameURI() throws Exception {
<b class="nc">&nbsp;		final String queryStr = &quot;PREFIX : &lt;urn:&gt; CONSTRUCT {:x :p :x } WHERE {} &quot;;</b>
&nbsp;
<b class="nc">&nbsp;		conn.add(new StringReader(&quot;@prefix : &lt;urn:&gt; . :a :p :b . &quot;), &quot;&quot;, RDFFormat.TURTLE);</b>
&nbsp;
<b class="nc">&nbsp;		final IRI x = conn.getValueFactory().createIRI(&quot;urn:x&quot;);</b>
<b class="nc">&nbsp;		final IRI p = conn.getValueFactory().createIRI(&quot;urn:p&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		GraphQuery query = conn.prepareGraphQuery(QueryLanguage.SPARQL, queryStr);</b>
<b class="nc">&nbsp;		try (GraphQueryResult evaluate = query.evaluate()) {</b>
<b class="nc">&nbsp;			Model result = QueryResults.asModel(evaluate);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertFalse(result.isEmpty());</b>
<b class="nc">&nbsp;			assertTrue(result.contains(x, p, x));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1898LeftJoinSemantics2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1898.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;  PREFIX : &lt;http://example.org/&gt; &quot; +</b>
&nbsp;				&quot;  SELECT * WHERE { &quot; +
&nbsp;				&quot;    ?s :p1 ?v1 . &quot; +
&nbsp;				&quot;    ?s :p3 ?v2 . &quot; +
&nbsp;				&quot;    OPTIONAL {?s :p2 ?v2 } .&quot; +
&nbsp;				&quot;  } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (Stream&lt;BindingSet&gt; result = tq.evaluate().stream()) {</b>
<b class="nc">&nbsp;			long count = result.count();</b>
<b class="nc">&nbsp;			assertEquals(1, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testIdenticalVariablesInStatementPattern() {
<b class="nc">&nbsp;		conn.add(alice, f.createIRI(&quot;http://purl.org/dc/elements/1.1/publisher&quot;), bob);</b>
&nbsp;
<b class="nc">&nbsp;		String queryBuilder = &quot;SELECT ?publisher &quot; +</b>
&nbsp;				&quot;{ ?publisher &lt;http://purl.org/dc/elements/1.1/publisher&gt; ?publisher }&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.prepareTupleQuery(QueryLanguage.SPARQL, queryBuilder)</b>
<b class="nc">&nbsp;				.evaluate(new AbstractTupleQueryResultHandler() {</b>
&nbsp;
&nbsp;					@Override
&nbsp;					public void handleSolution(BindingSet bindingSet) {
<b class="nc">&nbsp;						fail(&quot;nobody is self published&quot;);</b>
&nbsp;					}
&nbsp;				});
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testInComparison1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1913.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot; PREFIX : &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot; SELECT ?y WHERE { :a :p ?y. FILTER(?y in (:c, :d, 1/0 , 1)) } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			Value y = bs.getValue(&quot;y&quot;);</b>
<b class="nc">&nbsp;			assertNotNull(y);</b>
<b class="nc">&nbsp;			assertTrue(y instanceof Literal);</b>
<b class="nc">&nbsp;			assertEquals(f.createLiteral(&quot;1&quot;, CoreDatatype.XSD.INTEGER), y);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testInComparison2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1913.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot; PREFIX : &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot; SELECT ?y WHERE { :a :p ?y. FILTER(?y in (:c, :d, 1/0)) } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testInComparison3() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1913.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot; PREFIX : &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot; SELECT ?y WHERE { :a :p ?y. FILTER(?y in (:c, :d, 1, 1/0)) } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			Value y = bs.getValue(&quot;y&quot;);</b>
<b class="nc">&nbsp;			assertNotNull(y);</b>
<b class="nc">&nbsp;			assertTrue(y instanceof Literal);</b>
<b class="nc">&nbsp;			assertEquals(f.createLiteral(&quot;1&quot;, XSD.INTEGER), y);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2121URIFunction() {
<b class="nc">&nbsp;		String query = &quot;SELECT (URI(\&quot;foo bar\&quot;) as ?uri) WHERE {}&quot;;</b>
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			IRI uri = (IRI) bs.getValue(&quot;uri&quot;);</b>
<b class="nc">&nbsp;			assertNull(&quot;uri result for invalid URI should be unbound&quot;, uri);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		query = &quot;BASE &lt;http://example.org/&gt; SELECT (URI(\&quot;foo bar\&quot;) as ?uri) WHERE {}&quot;;</b>
<b class="nc">&nbsp;		tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			IRI uri = (IRI) bs.getValue(&quot;uri&quot;);</b>
<b class="nc">&nbsp;			assertNotNull(&quot;uri result for valid URI reference should be bound&quot;, uri);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void test27NormalizeIRIFunction() {
<b class="nc">&nbsp;		String query = &quot;SELECT (IRI(\&quot;../bar\&quot;) as ?Iri) WHERE {}&quot;;</b>
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query, &quot;http://example.com/foo/&quot;);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			IRI actual = (IRI) bs.getValue(&quot;Iri&quot;);</b>
<b class="nc">&nbsp;			IRI expected = f.createIRI(&quot;http://example.com/bar&quot;);</b>
<b class="nc">&nbsp;			assertEquals(&quot;IRI result for relative IRI should be normalized&quot;, expected, actual);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES869ValueOfNow() {
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL,</b>
&nbsp;				&quot;SELECT ?p ( NOW() as ?n ) { BIND (NOW() as ?p ) }&quot;);
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			Value p = bs.getValue(&quot;p&quot;);</b>
<b class="nc">&nbsp;			Value n = bs.getValue(&quot;n&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(p);</b>
<b class="nc">&nbsp;			assertNotNull(n);</b>
<b class="nc">&nbsp;			assertEquals(p, n);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2136() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testcases-sparql-1.1-w3c/bindings/data02.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;PREFIX : &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot;SELECT ?s ?o { \n&quot; +
&nbsp;				&quot; { SELECT * WHERE { ?s ?p ?o . } }\n&quot; +
&nbsp;				&quot;	VALUES (?o) { (:b) }\n&quot; +
&nbsp;				&quot;}\n&quot;;
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		final IRI a = vf.createIRI(&quot;http://example.org/a&quot;);</b>
<b class="nc">&nbsp;		final IRI b = vf.createIRI(&quot;http://example.org/b&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			assertFalse(&quot;only one result expected&quot;, result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(a, bs.getValue(&quot;s&quot;));</b>
<b class="nc">&nbsp;			assertEquals(b, bs.getValue(&quot;o&quot;));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testRegexCaseNonAscii() {
<b class="nc">&nbsp;		String query = &quot;ask {filter (regex(\&quot;\&quot;, \&quot;\&quot;, \&quot;i\&quot;)) }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		assertTrue(&quot;case-insensitive match on Cyrillic should succeed&quot;, conn.prepareBooleanQuery(query).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		query = &quot;ask {filter (regex(\&quot;\&quot;, \&quot;\&quot;)) }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		assertFalse(&quot;case-sensitive match on Cyrillic should fail&quot;, conn.prepareBooleanQuery(query).evaluate());</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testValuesInOptional() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1692.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot; PREFIX : &lt;http://example.org/&gt;\n&quot; +</b>
&nbsp;				&quot; SELECT DISTINCT ?a ?name ?isX WHERE { ?b :p1 ?a . ?a :name ?name. OPTIONAL { ?a a :X . VALUES(?isX) { (:X) } } } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;				// System.out.println(bs);
<b class="nc">&nbsp;				IRI a = (IRI) bs.getValue(&quot;a&quot;);</b>
<b class="nc">&nbsp;				assertNotNull(a);</b>
<b class="nc">&nbsp;				Value isX = bs.getValue(&quot;isX&quot;);</b>
<b class="nc">&nbsp;				Literal name = (Literal) bs.getValue(&quot;name&quot;);</b>
<b class="nc">&nbsp;				assertNotNull(name);</b>
<b class="nc">&nbsp;				if (a.stringValue().endsWith(&quot;a1&quot;)) {</b>
<b class="nc">&nbsp;					assertNotNull(isX);</b>
<b class="nc">&nbsp;				} else if (a.stringValue().endsWith((&quot;a2&quot;))) {</b>
<b class="nc">&nbsp;					assertNull(isX);</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(2, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/3072
&nbsp;	 *
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testValuesAfterOptional() throws Exception {
<b class="nc">&nbsp;		String data = &quot;@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; . \n&quot;</b>
&nbsp;				+ &quot;@prefix :     &lt;urn:ex:&gt; . \n&quot;
&nbsp;				+ &quot;:r1 a rdfs:Resource . \n&quot;
&nbsp;				+ &quot;:r2 a rdfs:Resource ; rdfs:label \&quot;a label\&quot; . \n&quot;;
&nbsp;
<b class="nc">&nbsp;		String query = &quot;&quot;</b>
&nbsp;				+ &quot;prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; \n&quot;
&nbsp;				+ &quot;prefix :     &lt;urn:ex:&gt; \n&quot;
&nbsp;				+ &quot;\n&quot;
&nbsp;				+ &quot;select ?resource ?label where { \n&quot;
&nbsp;				+ &quot;  ?resource a rdfs:Resource . \n&quot;
&nbsp;				+ &quot;  optional { ?resource rdfs:label ?label } \n&quot;
&nbsp;				+ &quot;  values ?label { undef } \n&quot;
&nbsp;				+ &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.add(new StringReader(data), RDFFormat.TURTLE);</b>
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(conn.prepareTupleQuery(query).evaluate());</b>
<b class="nc">&nbsp;		assertThat(result).hasSize(2);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testMaxAggregateWithGroupEmptyResult() {
<b class="nc">&nbsp;		String query = &quot;select ?s (max(?o) as ?omax) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot; +
&nbsp;				&quot; group by ?s\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.hasNext()).isFalse();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testMaxAggregateWithoutGroupEmptySolution() {
<b class="nc">&nbsp;		String query = &quot;select (max(?o) as ?omax) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.next()).isEmpty();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testMinAggregateWithGroupEmptyResult() {
<b class="nc">&nbsp;		String query = &quot;select ?s (min(?o) as ?omin) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot; +
&nbsp;				&quot; group by ?s\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.hasNext()).isFalse();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testMinAggregateWithoutGroupEmptySolution() {
<b class="nc">&nbsp;		String query = &quot;select (min(?o) as ?omin) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.next()).isEmpty();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testSampleAggregateWithGroupEmptyResult() {
<b class="nc">&nbsp;		String query = &quot;select ?s (sample(?o) as ?osample) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot; +
&nbsp;				&quot; group by ?s\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.hasNext()).isFalse();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1978
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testSampleAggregateWithoutGroupEmptySolution() {
<b class="nc">&nbsp;		String query = &quot;select (sample(?o) as ?osample) {\n&quot; +</b>
&nbsp;				&quot;   ?s ?p ?o .\n&quot; +
&nbsp;				&quot; }\n&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(query).evaluate()) {</b>
<b class="nc">&nbsp;			assertThat(result.next()).isEmpty();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2052If1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?p \n&quot; +</b>
&nbsp;				&quot;WHERE { \n&quot; +
&nbsp;				&quot;         ?s ?p ?o . \n&quot; +
&nbsp;				&quot;        FILTER(IF(BOUND(?p), ?p = &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;, false)) \n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
<b class="nc">&nbsp;				IRI p = (IRI) bs.getValue(&quot;p&quot;);</b>
<b class="nc">&nbsp;				assertNotNull(p);</b>
<b class="nc">&nbsp;				assertEquals(RDF.TYPE, p);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (Exception e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2052If2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?p \n&quot; +</b>
&nbsp;				&quot;WHERE { \n&quot; +
&nbsp;				&quot;         ?s ?p ?o . \n&quot; +
&nbsp;				&quot;        FILTER(IF(!BOUND(?p), false , ?p = &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;)) \n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
<b class="nc">&nbsp;				IRI p = (IRI) bs.getValue(&quot;p&quot;);</b>
<b class="nc">&nbsp;				assertNotNull(p);</b>
<b class="nc">&nbsp;				assertEquals(RDF.TYPE, p);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (Exception e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSameTermRepeatInUnion() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;PREFIX foaf:&lt;http://xmlns.com/foaf/0.1/&gt;\n&quot; +</b>
&nbsp;				&quot;SELECT * {\n&quot; +
&nbsp;				&quot;    {\n&quot; +
&nbsp;				&quot;        ?sameTerm foaf:mbox ?mbox\n&quot; +
&nbsp;				&quot;        FILTER sameTerm(?sameTerm,$william)\n&quot; +
&nbsp;				&quot;    } UNION {\n&quot; +
&nbsp;				&quot;        ?x foaf:knows ?sameTerm\n&quot; +
&nbsp;				&quot;        FILTER sameTerm(?sameTerm,$william)\n&quot; +
&nbsp;				&quot;    }\n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		tq.setBinding(&quot;william&quot;, conn.getValueFactory().createIRI(&quot;http://example.org/william&quot;));</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				Value mbox = bs.getValue(&quot;mbox&quot;);</b>
<b class="nc">&nbsp;				Value x = bs.getValue(&quot;x&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertTrue(mbox instanceof Literal || x instanceof IRI);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(3, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSameTermRepeatInUnionAndOptional() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT * {\n&quot; +
&nbsp;				&quot;    {\n&quot; +
&nbsp;				&quot;        ex:a ?p ?prop1\n&quot; +
&nbsp;				&quot;        FILTER (?p = ex:prop1)\n&quot; +
&nbsp;				&quot;    } UNION {\n&quot; +
&nbsp;				&quot;          ?s ex:p ex:A ; &quot; +
&nbsp;				&quot;          { &quot; +
&nbsp;				&quot;              { &quot; +
&nbsp;				&quot;                 ?s ?p ?l .&quot; +
&nbsp;				&quot;                 FILTER(?p = rdfs:label) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;              OPTIONAL { &quot; +
&nbsp;				&quot;                 ?s ?p ?opt1 . &quot; +
&nbsp;				&quot;                 FILTER (?p = ex:prop1) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;              OPTIONAL { &quot; +
&nbsp;				&quot;                 ?s ?p ?opt2 . &quot; +
&nbsp;				&quot;                 FILTER (?p = ex:prop2) &quot; +
&nbsp;				&quot;              } &quot; +
&nbsp;				&quot;          }&quot; +
&nbsp;				&quot;    }\n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				Value prop1 = bs.getValue(&quot;prop1&quot;);</b>
<b class="nc">&nbsp;				Value l = bs.getValue(&quot;l&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertTrue(prop1 instanceof Literal || l instanceof Literal);</b>
<b class="nc">&nbsp;				if (l instanceof Literal) {</b>
<b class="nc">&nbsp;					Value opt1 = bs.getValue(&quot;opt1&quot;);</b>
<b class="nc">&nbsp;					assertNull(opt1);</b>
&nbsp;
<b class="nc">&nbsp;					Value opt2 = bs.getValue(&quot;opt2&quot;);</b>
<b class="nc">&nbsp;					assertNull(opt2);</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(2, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testPropertyPathInTree() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT ?node ?name &quot; +
&nbsp;				&quot; FROM ex:tree-graph &quot; +
&nbsp;				&quot; WHERE { ?node ex:hasParent+ ex:b . ?node ex:name ?name . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
&nbsp;				// System.out.println(bs);
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testFilterRegexBoolean() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
&nbsp;
&nbsp;		// test case for issue SES-1050
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot; SELECT *&quot; +
&nbsp;				&quot; WHERE { &quot; +
&nbsp;				&quot;       ?x foaf:name ?name ; &quot; +
&nbsp;				&quot;          foaf:mbox ?mbox . &quot; +
&nbsp;				&quot;       FILTER(EXISTS { &quot; +
&nbsp;				&quot;            FILTER(REGEX(?name, \&quot;Bo\&quot;) &amp;&amp; REGEX(?mbox, \&quot;bob\&quot;)) &quot; +
&nbsp;				// query.append(&quot; FILTER(REGEX(?mbox, \&quot;bob\&quot;)) &quot;);
&nbsp;				&quot;            } )&quot; +
&nbsp;				&quot; } &quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (Stream&lt;BindingSet&gt; result = tq.evaluate().stream()) {</b>
<b class="nc">&nbsp;			long count = result.count();</b>
<b class="nc">&nbsp;			assertEquals(1, count);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testGroupConcatNonDistinct() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-query.trig&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT (GROUP_CONCAT(?l) AS ?concat)&quot; +
&nbsp;				&quot;WHERE { ex:groupconcat-test ?p ?l . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertNotNull(bs);</b>
&nbsp;
<b class="nc">&nbsp;				Value concat = bs.getValue(&quot;concat&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				assertTrue(concat instanceof Literal);</b>
&nbsp;
<b class="nc">&nbsp;				String lexValue = ((Literal) concat).getLabel();</b>
&nbsp;
<b class="nc">&nbsp;				int occ = countCharOccurrences(lexValue, &#39;a&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;b&#39;);</b>
<b class="nc">&nbsp;				assertEquals(2, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;c&#39;);</b>
<b class="nc">&nbsp;				assertEquals(2, occ);</b>
<b class="nc">&nbsp;				occ = countCharOccurrences(lexValue, &#39;d&#39;);</b>
<b class="nc">&nbsp;				assertEquals(1, occ);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child a owl:Class . ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;parent&quot;, OWL.THING);</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(4, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
&nbsp;
&nbsp;		// query without initializing ?child first.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;parent&quot;, OWL.THING);</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(4, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding3() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding4() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;, this.alice);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding5() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;, this.alice, this.bob);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
&nbsp;			// System.out.println(&quot;--- testArbitraryLengthPathWithBinding5
&nbsp;			// ---&quot;);
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding6() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;, this.alice, this.bob, this.mary);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
&nbsp;			// System.out.println(&quot;--- testArbitraryLengthPathWithBinding6
&nbsp;			// ---&quot;);
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding7() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;, this.alice, this.bob, this.mary);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		SimpleDataset dt = new SimpleDataset();</b>
<b class="nc">&nbsp;		dt.addDefaultGraph(this.alice);</b>
<b class="nc">&nbsp;		tq.setDataset(dt);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
&nbsp;			// System.out.println(&quot;--- testArbitraryLengthPathWithBinding7
&nbsp;			// ---&quot;);
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithBinding8() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;, this.alice, this.bob, this.mary);</b>
&nbsp;
&nbsp;		// binding on child instead of parent.
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
<b class="nc">&nbsp;		SimpleDataset dt = new SimpleDataset();</b>
<b class="nc">&nbsp;		dt.addDefaultGraph(this.alice);</b>
<b class="nc">&nbsp;		dt.addDefaultGraph(this.bob);</b>
<b class="nc">&nbsp;		tq.setDataset(dt);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;			// first execute without binding
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;			// System.out.println(&quot;--- testArbitraryLengthPathWithBinding8
&nbsp;			// ---&quot;);
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
&nbsp;
&nbsp;				// System.out.println(bs);
&nbsp;
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(7, count);</b>
&nbsp;
&nbsp;			// execute again, but this time setting a binding
<b class="nc">&nbsp;			tq.setBinding(&quot;child&quot;, f.createIRI(EX_NS, &quot;C&quot;));</b>
&nbsp;
<b class="nc">&nbsp;			try (TupleQueryResult result2 = tq.evaluate()) {</b>
<b class="nc">&nbsp;				assertNotNull(result2);</b>
&nbsp;
<b class="nc">&nbsp;				count = 0;</b>
<b class="nc">&nbsp;				while (result2.hasNext()) {</b>
<b class="nc">&nbsp;					count++;</b>
<b class="nc">&nbsp;					BindingSet bs = result2.next();</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;					assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				assertEquals(2, count);</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithFilter1() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child a owl:Class . ?child rdfs:subClassOf+ ?parent . FILTER (?parent = owl:Thing) }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(4, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithFilter2() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . FILTER (?parent = owl:Thing) }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(4, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;http://www.openrdf.org/issues/browse/SES-1091&quot;&gt;SES-1091&lt;/a&gt;
&nbsp;	 * @throws Exception
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testArbitraryLengthPathWithFilter3() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/alp-testdata.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?parent ?child &quot; +
&nbsp;				&quot;WHERE { ?child rdfs:subClassOf+ ?parent . FILTER (?child = &lt;http://example.org/C&gt;) }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			int count = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				BindingSet bs = result.next();</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;child&quot;));</b>
<b class="nc">&nbsp;				assertTrue(bs.hasBinding(&quot;parent&quot;));</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(2, count);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @see &lt;a href=&quot;https://github.com/eclipse/rdf4j/issues/2727&quot;&gt;GH-2727&lt;/a&gt;
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testNestedInversePropertyPathWithZeroLength() {
<b class="nc">&nbsp;		String insert = &quot;insert data {\n&quot;</b>
&nbsp;				+ &quot;    &lt;urn:1&gt; &lt;urn:prop&gt; &lt;urn:object&gt; .\n&quot;
&nbsp;				+ &quot;    &lt;urn:2&gt; &lt;urn:prop&gt; &lt;urn:mid:1&gt; .\n&quot;
&nbsp;				+ &quot;    &lt;urn:mid:1&gt; &lt;urn:prop&gt; &lt;urn:object&gt; .\n&quot;
&nbsp;				+ &quot;    &lt;urn:3&gt; &lt;urn:prop&gt; &lt;urn:mid:2&gt; .\n&quot;
&nbsp;				+ &quot;    &lt;urn:mid:2&gt; &lt;urn:prop&gt; &lt;urn:mid:3&gt; .\n&quot;
&nbsp;				+ &quot;    &lt;urn:mid:3&gt; &lt;urn:prop&gt; &lt;urn:object&gt; .\n&quot;
&nbsp;				+ &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		String query = &quot;select * where { \n&quot;</b>
&nbsp;				+ &quot;    &lt;urn:object&gt; (^&lt;urn:prop&gt;)? ?o .\n&quot;
&nbsp;				+ &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.prepareUpdate(insert).execute();</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(query);</b>
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(tq.evaluate());</b>
<b class="nc">&nbsp;		assertThat(result).hasSize(4);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2147PropertyPathsWithIdenticalSubsPreds() throws Exception {
&nbsp;
<b class="nc">&nbsp;		String data = &quot;&lt;urn:s1&gt; &lt;urn:p&gt; &lt;urn:s2&gt; .\n&quot; +</b>
&nbsp;				&quot;&lt;urn:s2&gt; &lt;urn:p&gt; &lt;urn:s3&gt; .\n&quot; +
&nbsp;				&quot;&lt;urn:s3&gt; &lt;urn:q&gt; &lt;urn:s4&gt; .\n&quot; +
&nbsp;				&quot;&lt;urn:s1&gt; &lt;urn:p&gt; &lt;urn:s5&gt; .\n&quot; +
&nbsp;				&quot;&lt;urn:s5&gt; &lt;urn:q&gt; &lt;urn:s6&gt; .\n&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.begin();</b>
<b class="nc">&nbsp;		conn.add(new StringReader(data), &quot;&quot;, RDFFormat.NTRIPLES);</b>
<b class="nc">&nbsp;		conn.commit();</b>
&nbsp;
<b class="nc">&nbsp;		String query = getNamespaceDeclarations() +</b>
&nbsp;				&quot;SELECT ?x \n&quot; +
&nbsp;				&quot;WHERE { ?x &lt;urn:p&gt;*/&lt;urn:q&gt; &lt;urn:s4&gt; . \n&quot; +
&nbsp;				&quot;        ?x &lt;urn:p&gt;*/&lt;urn:q&gt; &lt;urn:s6&gt; . \n&quot; +
&nbsp;				&quot;} \n&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;			Value x = result.next().getValue(&quot;x&quot;);</b>
<b class="nc">&nbsp;			assertNotNull(x);</b>
<b class="nc">&nbsp;			assertTrue(x instanceof IRI);</b>
<b class="nc">&nbsp;			assertEquals(&quot;urn:s1&quot;, x.stringValue());</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1991UUIDEvaluation() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/defaultgraph.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?uid WHERE {?s ?p ?o . BIND(UUID() as ?uid) } LIMIT 2&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			IRI uuid1 = (IRI) result.next().getValue(&quot;uid&quot;);</b>
<b class="nc">&nbsp;			IRI uuid2 = (IRI) result.next().getValue(&quot;uid&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(uuid1);</b>
<b class="nc">&nbsp;			assertNotNull(uuid2);</b>
<b class="nc">&nbsp;			assertNotEquals(uuid1, uuid2);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1991STRUUIDEvaluation() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/defaultgraph.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?uid WHERE {?s ?p ?o . BIND(STRUUID() as ?uid) } LIMIT 2&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			Literal uid1 = (Literal) result.next().getValue(&quot;uid&quot;);</b>
<b class="nc">&nbsp;			Literal uid2 = (Literal) result.next().getValue(&quot;uid&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(uid1);</b>
<b class="nc">&nbsp;			assertNotEquals(uid1, uid2);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1991RANDEvaluation() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/defaultgraph.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?r WHERE {?s ?p ?o . BIND(RAND() as ?r) } LIMIT 3&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			Literal r1 = (Literal) result.next().getValue(&quot;r&quot;);</b>
<b class="nc">&nbsp;			Literal r2 = (Literal) result.next().getValue(&quot;r&quot;);</b>
<b class="nc">&nbsp;			Literal r3 = (Literal) result.next().getValue(&quot;r&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(r1);</b>
&nbsp;
&nbsp;			// there is a small chance that two successive calls to the random
&nbsp;			// number generator will generate the exact same value, so we check
&nbsp;			// for
&nbsp;			// three successive calls (still theoretically possible to be
&nbsp;			// identical, but phenomenally unlikely).
<b class="nc">&nbsp;			assertFalse(r1.equals(r2) &amp;&amp; r1.equals(r3));</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1991NOWEvaluation() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/defaultgraph.ttl&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;SELECT ?d WHERE {?s ?p ?o . BIND(NOW() as ?d) } LIMIT 2&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			Literal d1 = (Literal) result.next().getValue(&quot;d&quot;);</b>
<b class="nc">&nbsp;			Literal d2 = (Literal) result.next().getValue(&quot;d&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(d1);</b>
<b class="nc">&nbsp;			assertEquals(d1, d2);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2024PropertyPathAnonVarSharing() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses2024.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;PREFIX : &lt;http://example.org/&gt; SELECT * WHERE { ?x1 :p/:lit ?l1 . ?x1 :diff ?x2 . ?x2 :p/:lit ?l2 . }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			BindingSet bs = result.next();</b>
<b class="nc">&nbsp;			Literal l1 = (Literal) bs.getValue(&quot;l1&quot;);</b>
<b class="nc">&nbsp;			Literal l2 = (Literal) bs.getValue(&quot;l2&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertNotNull(l1);</b>
<b class="nc">&nbsp;			assertNotEquals(l1, l2);</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testPropertyPathNegationInversion() throws Exception {
<b class="nc">&nbsp;		String data = &quot;@prefix : &lt;http://example.org/&gt;.\n&quot;</b>
&nbsp;				+ &quot;:Mary :parentOf :Jim.\n&quot;
&nbsp;				+ &quot;:Jim :knows :Jane.\n&quot;
&nbsp;				+ &quot;:Jane :worksFor :IBM.&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.add(new StringReader(data), &quot;&quot;, RDFFormat.TURTLE);</b>
<b class="nc">&nbsp;		String query1 = &quot;prefix : &lt;http://example.org/&gt; ASK WHERE { :IBM ^(:|!:) :Jane } &quot;;</b>
&nbsp;
<b class="nc">&nbsp;		assertTrue(conn.prepareBooleanQuery(query1).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		String query2 = &quot;prefix : &lt;http://example.org/&gt; ASK WHERE { :IBM ^(:|!:) ?a } &quot;;</b>
<b class="nc">&nbsp;		assertTrue(conn.prepareBooleanQuery(query2).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		String query3 = &quot;prefix : &lt;http://example.org/&gt; ASK WHERE { :IBM (^(:|!:))* :Mary } &quot;;</b>
<b class="nc">&nbsp;		assertTrue(conn.prepareBooleanQuery(query3).evaluate());</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2361UndefMin() {
<b class="nc">&nbsp;		String query = &quot;SELECT (MIN(?v) as ?min) WHERE { VALUES ?v { 1 2 undef 3 4 }}&quot;;</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;1&quot;, result.next().getValue(&quot;min&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2361UndefMax() {
<b class="nc">&nbsp;		String query = &quot;SELECT (MAX(?v) as ?max) WHERE { VALUES ?v { 1 2 7 undef 3 4 }}&quot;;</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;7&quot;, result.next().getValue(&quot;max&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2361UndefCount() {
<b class="nc">&nbsp;		String query = &quot;SELECT (COUNT(?v) as ?c) WHERE { VALUES ?v { 1 2 undef 3 4 }}&quot;;</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;4&quot;, result.next().getValue(&quot;c&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2361UndefCountWildcard() {
<b class="nc">&nbsp;		String query = &quot;SELECT (COUNT(*) as ?c) WHERE { VALUES ?v { 1 2 undef 3 4 }}&quot;;</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;4&quot;, result.next().getValue(&quot;c&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2361UndefSum() {
<b class="nc">&nbsp;		String query = &quot;SELECT (SUM(?v) as ?s) WHERE { VALUES ?v { 1 2 undef 3 4 }}&quot;;</b>
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;10&quot;, result.next().getValue(&quot;s&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2336NegatedPropertyPathMod() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses2336.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;prefix : &lt;http://example.org/&gt; select * where { ?s a :Test ; !:p? ?o . }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult evaluate = tq.evaluate()) {</b>
<b class="nc">&nbsp;			List&lt;BindingSet&gt; result = QueryResults.asList(evaluate);</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
&nbsp;
<b class="nc">&nbsp;			IRI a = vf.createIRI(EX_NS, &quot;a&quot;);</b>
<b class="nc">&nbsp;			IRI b = vf.createIRI(EX_NS, &quot;b&quot;);</b>
<b class="nc">&nbsp;			IRI c = vf.createIRI(EX_NS, &quot;c&quot;);</b>
<b class="nc">&nbsp;			IRI d = vf.createIRI(EX_NS, &quot;d&quot;);</b>
<b class="nc">&nbsp;			IRI e = vf.createIRI(EX_NS, &quot;e&quot;);</b>
<b class="nc">&nbsp;			IRI test = vf.createIRI(EX_NS, &quot;Test&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, a), new SimpleBinding(&quot;o&quot;, a)));</b>
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, a), new SimpleBinding(&quot;o&quot;, test)));</b>
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, a), new SimpleBinding(&quot;o&quot;, c)));</b>
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, d), new SimpleBinding(&quot;o&quot;, d)));</b>
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, d), new SimpleBinding(&quot;o&quot;, e)));</b>
<b class="nc">&nbsp;			assertTrue(containsSolution(result, new SimpleBinding(&quot;s&quot;, d), new SimpleBinding(&quot;o&quot;, test)));</b>
&nbsp;
<b class="nc">&nbsp;			assertFalse(containsSolution(result, new SimpleBinding(&quot;s&quot;, a), new SimpleBinding(&quot;o&quot;, b)));</b>
&nbsp;
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES1979MinMaxInf() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-ses1979.trig&quot;);</b>
<b class="nc">&nbsp;		String query = &quot;prefix : &lt;http://example.org/&gt; select (min(?o) as ?min) (max(?o) as ?max) where { ?s :float ?o }&quot;;</b>
&nbsp;
<b class="nc">&nbsp;		ValueFactory vf = conn.getValueFactory();</b>
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, query);</b>
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult evaluate = tq.evaluate()) {</b>
<b class="nc">&nbsp;			List&lt;BindingSet&gt; result = QueryResults.asList(evaluate);</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertEquals(1, result.size());</b>
&nbsp;
<b class="nc">&nbsp;			assertEquals(vf.createLiteral(Float.NEGATIVE_INFINITY), result.get(0).getValue(&quot;min&quot;));</b>
<b class="nc">&nbsp;			assertEquals(vf.createLiteral(Float.POSITIVE_INFINITY), result.get(0).getValue(&quot;max&quot;));</b>
<b class="nc">&nbsp;		} catch (QueryEvaluationException e) {</b>
<b class="nc">&nbsp;			e.printStackTrace();</b>
<b class="nc">&nbsp;			fail(e.getMessage());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1018
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testBindError() {
&nbsp;
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, &quot;insert data { &lt;urn:test:subj&gt; &lt;urn:test:pred&gt; _:blank }&quot;).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String qb = &quot;SELECT * \n&quot; +</b>
&nbsp;				&quot;WHERE { \n&quot; +
&nbsp;				&quot;  VALUES (?NAValue) { (&lt;http://null&gt;) } \n &quot; +
&nbsp;				&quot;  BIND(IF(?NAValue != &lt;http://null&gt;, ?NAValue, ?notBoundVar) as ?ValidNAValue) \n &quot; +
&nbsp;				&quot;  { ?disjClass (owl:disjointWith|^owl:disjointWith)? ?disjClass2 . }\n&quot; +
&nbsp;				&quot;}\n&quot;;
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(conn.prepareTupleQuery(qb).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		assertEquals(&quot;query should return 2 solutions&quot;, 2, result.size());</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1405
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testBindScope() {
<b class="nc">&nbsp;		String query = &quot;SELECT * {\n&quot; +</b>
&nbsp;				&quot;  { BIND (\&quot;a\&quot; AS ?a) }\n&quot; +
&nbsp;				&quot;  { BIND (?a AS ?b) } \n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery q = conn.prepareTupleQuery(query);</b>
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(q.evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		assertEquals(1, result.size());</b>
&nbsp;
<b class="nc">&nbsp;		assertEquals(conn.getValueFactory().createLiteral(&quot;a&quot;), result.get(0).getValue(&quot;a&quot;));</b>
<b class="nc">&nbsp;		assertNull(result.get(0).getValue(&quot;b&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1642
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testBindScopeUnion() {
&nbsp;
<b class="nc">&nbsp;		ValueFactory f = conn.getValueFactory();</b>
<b class="nc">&nbsp;		String query = &quot;prefix ex: &lt;http://example.org/&gt; \n&quot; +</b>
&nbsp;				&quot;select * {\n&quot; +
&nbsp;				&quot;  bind(ex:v1 as ?v)\n&quot; +
&nbsp;				&quot;  bind(strafter(str(?v),str(ex:)) as ?b)\n&quot; +
&nbsp;				&quot;  {\n&quot; +
&nbsp;				&quot;    bind(?b as ?b1)\n&quot; +
&nbsp;				&quot;  } union {\n&quot; +
&nbsp;				&quot;    bind(?b as ?b2)\n&quot; +
&nbsp;				&quot;  }\n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery q = conn.prepareTupleQuery(query);</b>
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(q.evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		assertEquals(2, result.size());</b>
&nbsp;
<b class="nc">&nbsp;		IRI v1 = f.createIRI(&quot;http://example.org/v1&quot;);</b>
<b class="nc">&nbsp;		Literal b = f.createLiteral(&quot;v1&quot;);</b>
<b class="nc">&nbsp;		for (BindingSet bs : result) {</b>
<b class="nc">&nbsp;			assertThat(bs.getValue(&quot;v&quot;)).isEqualTo(v1);</b>
<b class="nc">&nbsp;			assertThat(bs.getValue(&quot;b1&quot;)).isNull();</b>
<b class="nc">&nbsp;			assertThat(bs.getValue(&quot;b2&quot;)).isNull();</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2250BindErrors() {
&nbsp;
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, &quot;insert data { &lt;urn:test:subj&gt; &lt;urn:test:pred&gt; _:blank }&quot;).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String qb = &quot;SELECT * {\n&quot; + &quot;    ?s1 ?p1 ?blank . &quot; + &quot;    FILTER(isBlank(?blank))&quot;</b>
&nbsp;				+ &quot;    BIND (iri(?blank) as ?biri)&quot; + &quot;    ?biri ?p2 ?o2 .&quot; + &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, qb);</b>
<b class="nc">&nbsp;		try (TupleQueryResult evaluate = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertFalse(&quot;The query should not return a result&quot;, evaluate.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSES2250BindErrorsInPath() {
&nbsp;
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, &quot;insert data { &lt;urn:test:subj&gt; &lt;urn:test:pred&gt; _:blank }&quot;).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String qb = &quot;SELECT * {\n&quot; + &quot;    ?s1 ?p1 ?blank . &quot; + &quot;    FILTER(isBlank(?blank))&quot;</b>
&nbsp;				+ &quot;    BIND (iri(?blank) as ?biri)&quot; + &quot;    ?biri &lt;urn:test:pred&gt;* ?o2 .&quot; + &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(QueryLanguage.SPARQL, qb);</b>
<b class="nc">&nbsp;		try (TupleQueryResult evaluate = tq.evaluate()) {</b>
<b class="nc">&nbsp;			assertFalse(&quot;The query should not return a result&quot;, evaluate.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testEmptyUnion() {
<b class="nc">&nbsp;		String query = &quot;PREFIX : &lt;http://example.org/&gt; &quot; + &quot;SELECT ?visibility WHERE {&quot;</b>
&nbsp;				+ &quot;OPTIONAL { SELECT ?var WHERE { :s a :MyType . BIND (:s as ?var ) .} } .&quot;
&nbsp;				+ &quot;BIND (IF(BOUND(?var), &#39;VISIBLE&#39;, &#39;HIDDEN&#39;) as ?visibility)&quot; + &quot;}&quot;;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, query).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * https://github.com/eclipse/rdf4j/issues/1026
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testFilterExistsExternalValuesClause() {
<b class="nc">&nbsp;		String ub = &quot;insert data {\n&quot; +</b>
&nbsp;				&quot;  &lt;http://subj1&gt; a &lt;http://type&gt; .\n&quot; +
&nbsp;				&quot;  &lt;http://subj2&gt; a &lt;http://type&gt; .\n&quot; +
&nbsp;				&quot;  &lt;http://subj1&gt; &lt;http://predicate&gt; &lt;http://obj1&gt; .\n&quot; +
&nbsp;				&quot;  &lt;http://subj2&gt; &lt;http://predicate&gt; &lt;http://obj2&gt; .\n&quot; +
&nbsp;				&quot;}&quot;;
<b class="nc">&nbsp;		conn.prepareUpdate(QueryLanguage.SPARQL, ub).execute();</b>
&nbsp;
<b class="nc">&nbsp;		String query = &quot;select ?s  {\n&quot; + &quot;    ?s a* &lt;http://type&gt; .\n&quot;</b>
&nbsp;				+ &quot;    FILTER EXISTS {?s &lt;http://predicate&gt; ?o}\n&quot;
&nbsp;				+ &quot;} limit 100 values ?o {&lt;http://obj1&gt;}&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery tq = conn.prepareTupleQuery(query);</b>
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(tq.evaluate());</b>
<b class="nc">&nbsp;		assertEquals(&quot;single result expected&quot;, 1, result.size());</b>
<b class="nc">&nbsp;		assertEquals(&quot;http://subj1&quot;, result.get(0).getValue(&quot;s&quot;).stringValue());</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testValuesClauseNamedGraph() throws Exception {
<b class="nc">&nbsp;		String ex = &quot;http://example.org/&quot;;</b>
<b class="nc">&nbsp;		String data = &quot;@prefix foaf: &lt;&quot; + FOAF.NAMESPACE + &quot;&gt; .\n&quot;</b>
&nbsp;				+ &quot;@prefix ex: &lt;&quot; + ex + &quot;&gt; .\n&quot;
&nbsp;				+ &quot;ex:graph1 {\n&quot; +
&nbsp;				&quot;	ex:Person1 rdf:type foaf:Person ;\n&quot; +
&nbsp;				&quot;		foaf:name \&quot;Person 1\&quot; .	ex:Person2 rdf:type foaf:Person ;\n&quot; +
&nbsp;				&quot;		foaf:name \&quot;Person 2\&quot; .	ex:Person3 rdf:type foaf:Person ;\n&quot; +
&nbsp;				&quot;		foaf:name \&quot;Person 3\&quot; .\n&quot; +
&nbsp;				&quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		conn.add(new StringReader(data), &quot;&quot;, RDFFormat.TRIG);</b>
&nbsp;
<b class="nc">&nbsp;		String query = &quot;SELECT  ?person ?name ?__index \n&quot;</b>
&nbsp;				+ &quot;WHERE { &quot;
&nbsp;				+ &quot;        VALUES (?person ?name  ?__index) { \n&quot;
&nbsp;				+ &quot;                  (&lt;http://example.org/Person1&gt; UNDEF \&quot;0\&quot;) \n&quot;
&nbsp;				+ &quot;                  (&lt;http://example.org/Person3&gt; UNDEF \&quot;2\&quot;)  } \n&quot;
&nbsp;				+ &quot;        GRAPH &lt;http://example.org/graph1&gt; { ?person &lt;http://xmlns.com/foaf/0.1/name&gt; ?name .   } }&quot;;
&nbsp;
<b class="nc">&nbsp;		TupleQuery q = conn.prepareTupleQuery(query);</b>
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(q.evaluate());</b>
<b class="nc">&nbsp;		assertThat(result).hasSize(2);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testValuesCartesianProduct() {
<b class="nc">&nbsp;		final String queryString = &quot;&quot;</b>
&nbsp;				+ &quot;select ?x ?y where { &quot;
&nbsp;				+ &quot;  values ?x { undef 67 } &quot;
&nbsp;				+ &quot;  values ?y { undef 42 } &quot;
&nbsp;				+ &quot;}&quot;;
<b class="nc">&nbsp;		final TupleQuery tupleQuery = conn.prepareTupleQuery(queryString);</b>
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; bindingSets = QueryResults.asList(tupleQuery.evaluate());</b>
<b class="nc">&nbsp;		assertThat(bindingSets).hasSize(4);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1267
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testSeconds() {
<b class="nc">&nbsp;		String qry = &quot;PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; &quot;</b>
&nbsp;				+ &quot;SELECT (SECONDS(\&quot;2011-01-10T14:45:13\&quot;^^xsd:dateTime) AS ?sec) { }&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, qry).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;13&quot;, result.next().getValue(&quot;sec&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/1267
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testSecondsMilliseconds() {
<b class="nc">&nbsp;		String qry = &quot;PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; &quot;</b>
&nbsp;				+ &quot;SELECT (SECONDS(\&quot;2011-01-10T14:45:13.815-05:00\&quot;^^xsd:dateTime) AS ?sec) { }&quot;;
&nbsp;
<b class="nc">&nbsp;		try (TupleQueryResult result = conn.prepareTupleQuery(QueryLanguage.SPARQL, qry).evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			assertEquals(&quot;13.815&quot;, result.next().getValue(&quot;sec&quot;).stringValue());</b>
<b class="nc">&nbsp;			assertFalse(result.hasNext());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testConstructModifiers() throws Exception {
<b class="nc">&nbsp;		loadTestData(&quot;/testdata-query/dataset-construct-modifiers.ttl&quot;);</b>
<b class="nc">&nbsp;		String qry = &quot;PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt; \n&quot;</b>
&nbsp;				+ &quot;PREFIX site: &lt;http://example.org/stats#&gt; \n&quot;
&nbsp;				+ &quot;CONSTRUCT { \n&quot;
&nbsp;				+ &quot;  ?iri foaf:name ?name . \n&quot;
&nbsp;				+ &quot;  ?iri foaf:nick ?nick . \n&quot;
&nbsp;				+ &quot;} \n&quot;
&nbsp;				+ &quot;WHERE { \n&quot;
&nbsp;				+ &quot;  ?iri foaf:name ?name ; \n&quot;
&nbsp;				+ &quot;    site:hits ?hits ; \n&quot;
&nbsp;				+ &quot;    foaf:nick ?nick . \n&quot;
&nbsp;				+ &quot;} \n&quot;
&nbsp;				+ &quot;ORDER BY desc(?hits) \n&quot;
&nbsp;				+ &quot;LIMIT 3&quot;;
<b class="nc">&nbsp;		Statement[] correctResult = {</b>
<b class="nc">&nbsp;				statement(iri(&quot;urn:1&quot;), iri(&quot;http://xmlns.com/foaf/0.1/name&quot;), literal(&quot;Alice&quot;), null),</b>
<b class="nc">&nbsp;				statement(iri(&quot;urn:1&quot;), iri(&quot;http://xmlns.com/foaf/0.1/nick&quot;), literal(&quot;Al&quot;), null),</b>
&nbsp;
<b class="nc">&nbsp;				statement(iri(&quot;urn:3&quot;), iri(&quot;http://xmlns.com/foaf/0.1/name&quot;), literal(&quot;Eve&quot;), null),</b>
<b class="nc">&nbsp;				statement(iri(&quot;urn:3&quot;), iri(&quot;http://xmlns.com/foaf/0.1/nick&quot;), literal(&quot;Ev&quot;), null),</b>
&nbsp;
<b class="nc">&nbsp;				statement(iri(&quot;urn:2&quot;), iri(&quot;http://xmlns.com/foaf/0.1/name&quot;), literal(&quot;Bob&quot;), null),</b>
<b class="nc">&nbsp;				statement(iri(&quot;urn:2&quot;), iri(&quot;http://xmlns.com/foaf/0.1/nick&quot;), literal(&quot;Bo&quot;), null),</b>
&nbsp;		};
<b class="nc">&nbsp;		GraphQuery gq = conn.prepareGraphQuery(qry);</b>
<b class="nc">&nbsp;		try (GraphQueryResult result = gq.evaluate()) {</b>
<b class="nc">&nbsp;			assertNotNull(result);</b>
<b class="nc">&nbsp;			assertTrue(result.hasNext());</b>
<b class="nc">&nbsp;			int resultNo = 0;</b>
<b class="nc">&nbsp;			while (result.hasNext()) {</b>
<b class="nc">&nbsp;				Statement st = result.next();</b>
<b class="nc">&nbsp;				assertThat(resultNo).isLessThan(correctResult.length);</b>
<b class="nc">&nbsp;				assertEquals(correctResult[resultNo], st);</b>
<b class="nc">&nbsp;				resultNo++;</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			assertEquals(correctResult.length, resultNo);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * See https://github.com/eclipse/rdf4j/issues/3011
&nbsp;	 */
&nbsp;	@Test
&nbsp;	public void testConstruct_CyclicPathWithJoin() {
<b class="nc">&nbsp;		IRI test = iri(&quot;urn:test&quot;), a = iri(&quot;urn:a&quot;), b = iri(&quot;urn:b&quot;), c = iri(&quot;urn:c&quot;);</b>
<b class="nc">&nbsp;		conn.add(test, RDF.TYPE, DCAT.CATALOG);</b>
&nbsp;
<b class="nc">&nbsp;		String query = &quot;PREFIX dcat: &lt;http://www.w3.org/ns/dcat#&gt;\n&quot;</b>
&nbsp;				+ &quot;\n&quot;
&nbsp;				+ &quot;CONSTRUCT {\n&quot;
&nbsp;				+ &quot;&lt;urn:a&gt; &lt;urn:b&gt; ?x .\n&quot;
&nbsp;				+ &quot;  ?x &lt;urn:c&gt; ?x .\n&quot;
&nbsp;				+ &quot;}\n&quot;
&nbsp;				+ &quot;WHERE {\n&quot;
&nbsp;				+ &quot;  ?x a dcat:Catalog .\n&quot;
&nbsp;				+ &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		Model result = QueryResults.asModel(conn.prepareGraphQuery(query).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		assertThat(result.contains(a, b, test)).isTrue();</b>
<b class="nc">&nbsp;		assertThat(result.contains(test, c, test)).isTrue();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Test
&nbsp;	public void testSelectBindOnly() {
<b class="nc">&nbsp;		String query = &quot;select ?b1 ?b2 ?b3\n&quot;</b>
&nbsp;				+ &quot;where {\n&quot;
&nbsp;				+ &quot;  bind(1 as ?b1)\n&quot;
&nbsp;				+ &quot;}&quot;;
&nbsp;
<b class="nc">&nbsp;		List&lt;BindingSet&gt; result = QueryResults.asList(conn.prepareTupleQuery(query).evaluate());</b>
&nbsp;
<b class="nc">&nbsp;		assertThat(result.size()).isEqualTo(1);</b>
<b class="nc">&nbsp;		BindingSet solution = result.get(0);</b>
&nbsp;
<b class="nc">&nbsp;		assertThat(solution.getValue(&quot;b1&quot;)).isEqualTo(literal(&quot;1&quot;, CoreDatatype.XSD.INTEGER));</b>
<b class="nc">&nbsp;		assertThat(solution.getValue(&quot;b2&quot;)).isNull();</b>
<b class="nc">&nbsp;		assertThat(solution.getValue(&quot;b3&quot;)).isNull();</b>
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	private boolean containsSolution(List&lt;BindingSet&gt; result, Binding... solution) {
<b class="nc">&nbsp;		final MapBindingSet bs = new MapBindingSet();</b>
<b class="nc">&nbsp;		for (Binding b : solution) {</b>
<b class="nc">&nbsp;			bs.addBinding(b);</b>
&nbsp;		}
<b class="nc">&nbsp;		return result.contains(bs);</b>
&nbsp;	}
&nbsp;
&nbsp;	/* private / protected methods */
&nbsp;
&nbsp;	private int countCharOccurrences(String string, char ch) {
<b class="nc">&nbsp;		int count = 0;</b>
<b class="nc">&nbsp;		for (int i = 0; i &lt; string.length(); i++) {</b>
<b class="nc">&nbsp;			if (string.charAt(i) == ch) {</b>
<b class="nc">&nbsp;				count++;</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		return count;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Get a set of useful namespace prefix declarations.
&nbsp;	 *
&nbsp;	 * @return namespace prefix declarations for dc, foaf and ex.
&nbsp;	 */
&nbsp;	protected String getNamespaceDeclarations() {
<b class="nc">&nbsp;		return &quot;PREFIX dc: &lt;&quot; + DCTERMS.NAMESPACE + &quot;&gt; \n&quot; +</b>
&nbsp;				&quot;PREFIX foaf: &lt;&quot; + FOAF.NAMESPACE + &quot;&gt; \n&quot; +
&nbsp;				&quot;PREFIX sesame: &lt;&quot; + SESAME.NAMESPACE + &quot;&gt; \n&quot; +
&nbsp;				&quot;PREFIX ex: &lt;&quot; + EX_NS + &quot;&gt; \n&quot; +
&nbsp;				&quot;\n&quot;;
&nbsp;	}
&nbsp;
&nbsp;	protected abstract Repository newRepository() throws Exception;
&nbsp;
&nbsp;	protected void loadTestData(String dataFile, Resource... contexts)
&nbsp;			throws RDFParseException, RepositoryException, IOException {
<b class="nc">&nbsp;		logger.debug(&quot;loading dataset {}&quot;, dataFile);</b>
<b class="nc">&nbsp;		try (InputStream dataset = ComplexSPARQLQueryTest.class.getResourceAsStream(dataFile)) {</b>
<b class="nc">&nbsp;			conn.add(dataset, &quot;&quot;, Rio.getParserFormatForFileName(dataFile).orElseThrow(Rio.unsupportedFormat(dataFile)),</b>
&nbsp;					contexts);
<b class="nc">&nbsp;		}</b>
<b class="nc">&nbsp;		logger.debug(&quot;dataset loaded.&quot;);</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-09-18 08:20</div>
</div>
</body>
</html>
