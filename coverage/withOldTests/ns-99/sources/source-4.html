


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > RepositoryManager</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.eclipse.rdf4j.repository.manager</a>
</div>

<h1>Coverage Summary for Class: RepositoryManager (org.eclipse.rdf4j.repository.manager)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RepositoryManager</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/70)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/139)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*******************************************************************************
&nbsp; * Copyright (c) 2015 Eclipse RDF4J contributors, Aduna, and others.
&nbsp; *
&nbsp; * All rights reserved. This program and the accompanying materials
&nbsp; * are made available under the terms of the Eclipse Distribution License v1.0
&nbsp; * which accompanies this distribution, and is available at
&nbsp; * http://www.eclipse.org/org/documents/edl-v10.php.
&nbsp; *
&nbsp; * SPDX-License-Identifier: BSD-3-Clause
&nbsp; *******************************************************************************/
&nbsp;package org.eclipse.rdf4j.repository.manager;
&nbsp;
&nbsp;import java.net.MalformedURLException;
&nbsp;import java.net.URL;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collection;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.LinkedHashSet;
&nbsp;import java.util.Map;
&nbsp;import java.util.Objects;
&nbsp;import java.util.Set;
&nbsp;
&nbsp;import org.apache.http.client.HttpClient;
&nbsp;import org.eclipse.rdf4j.http.client.HttpClientDependent;
&nbsp;import org.eclipse.rdf4j.model.IRI;
&nbsp;import org.eclipse.rdf4j.model.Model;
&nbsp;import org.eclipse.rdf4j.model.ModelFactory;
&nbsp;import org.eclipse.rdf4j.model.impl.LinkedHashModel;
&nbsp;import org.eclipse.rdf4j.model.impl.SimpleValueFactory;
&nbsp;import org.eclipse.rdf4j.model.impl.TreeModelFactory;
&nbsp;import org.eclipse.rdf4j.model.util.Values;
&nbsp;import org.eclipse.rdf4j.repository.Repository;
&nbsp;import org.eclipse.rdf4j.repository.RepositoryException;
&nbsp;import org.eclipse.rdf4j.repository.RepositoryResolver;
&nbsp;import org.eclipse.rdf4j.repository.config.RepositoryConfig;
&nbsp;import org.eclipse.rdf4j.repository.config.RepositoryConfigException;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;/**
&nbsp; * A manager for {@link Repository}s.
&nbsp; *
&nbsp; * @author Arjohn Kampman
&nbsp; * @see RepositoryProvider
&nbsp; */
&nbsp;public abstract class RepositoryManager implements RepositoryResolver, HttpClientDependent {
&nbsp;
&nbsp;	/*-----------*
&nbsp;	 * Constants *
&nbsp;	 *-----------*/
&nbsp;
<b class="nc">&nbsp;	protected final Logger logger = LoggerFactory.getLogger(this.getClass());</b>
&nbsp;
&nbsp;	/**
&nbsp;	 * The {@link org.eclipse.rdf4j.repository.sail.ProxyRepository} schema namespace (
&nbsp;	 * &lt;var&gt;http://www.openrdf.org/config/repository/proxy#&lt;/var&gt;).
&nbsp;	 */
&nbsp;	public static final String NAMESPACE = &quot;http://www.openrdf.org/config/repository/proxy#&quot;;
&nbsp;
&nbsp;	/** &lt;var&gt;http://www.openrdf.org/config/repository/proxy#proxiedID&lt;/var&gt; */
<b class="nc">&nbsp;	public final static IRI PROXIED_ID = SimpleValueFactory.getInstance().createIRI(NAMESPACE, &quot;proxiedID&quot;);</b>
&nbsp;
&nbsp;	/*-----------*
&nbsp;	 * Variables *
&nbsp;	 *-----------*/
&nbsp;
<b class="nc">&nbsp;	private ModelFactory modelFactory = new TreeModelFactory();</b>
&nbsp;
&nbsp;	protected Map&lt;String, Repository&gt; initializedRepositories;
&nbsp;
&nbsp;	private boolean initialized;
&nbsp;
&nbsp;	/*--------------*
&nbsp;	 * Constructors *
&nbsp;	 *--------------*/
&nbsp;
&nbsp;	/**
&nbsp;	 * Creates a new RepositoryManager.
&nbsp;	 */
&nbsp;	protected RepositoryManager() {
<b class="nc">&nbsp;		this(new HashMap&lt;&gt;());</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Create a new RepositoryManager using the given map to store repository information.
&nbsp;	 *
&nbsp;	 * @param initializedRepositories A map that will be used to store repository information.
&nbsp;	 */
<b class="nc">&nbsp;	protected RepositoryManager(Map&lt;String, Repository&gt; initializedRepositories) {</b>
<b class="nc">&nbsp;		setInitializedRepositories(initializedRepositories);</b>
&nbsp;	}
&nbsp;
&nbsp;	/*---------*
&nbsp;	 * Methods *
&nbsp;	 *---------*/
&nbsp;
&nbsp;	/**
&nbsp;	 * Indicates if this RepositoryManager has been initialized. Note that the initialization status may change if the
&nbsp;	 * Repository is shut down.
&nbsp;	 *
&nbsp;	 * @return true iff the repository manager has been initialized.
&nbsp;	 */
&nbsp;	public boolean isInitialized() {
<b class="nc">&nbsp;		return initialized;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @return Returns the httpClient passed to {@link Repository} construction.
&nbsp;	 */
&nbsp;	@Override
&nbsp;	public abstract HttpClient getHttpClient();
&nbsp;
&nbsp;	/**
&nbsp;	 * Should be called before {@link #init()}.
&nbsp;	 *
&nbsp;	 * @param httpClient The httpClient to use for remote/service calls.
&nbsp;	 */
&nbsp;	@Override
&nbsp;	public abstract void setHttpClient(HttpClient httpClient);
&nbsp;
&nbsp;	/**
&nbsp;	 * Get the {@link ModelFactory} used for creating new {@link Model} objects in the manager.
&nbsp;	 *
&nbsp;	 * @return the modelFactory
&nbsp;	 * @since 3.0
&nbsp;	 */
&nbsp;	public ModelFactory getModelFactory() {
<b class="nc">&nbsp;		return modelFactory;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Set the {@link ModelFactory} to use for creating new {@link Model} objects in the manager.
&nbsp;	 *
&nbsp;	 * @param modelFactory the modelFactory to set. May not be &lt;code&gt;null&lt;/code&gt;.
&nbsp;	 * @since 3.0
&nbsp;	 */
&nbsp;	public void setModelFactory(ModelFactory modelFactory) {
<b class="nc">&nbsp;		Objects.requireNonNull(modelFactory);</b>
<b class="nc">&nbsp;		this.modelFactory = modelFactory;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Initializes the repository manager.
&nbsp;	 *
&nbsp;	 * @throws RepositoryException If the manager failed to initialize.
&nbsp;	 * @since 2.5
&nbsp;	 */
&nbsp;	public void init() throws RepositoryException {
<b class="nc">&nbsp;		initialized = true;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Generates an ID for a new repository based on the specified base name. The base name may for example be a
&nbsp;	 * repository name entered by the user. The generated ID will contain a variant of this name that does not occur as
&nbsp;	 * a repository ID in this manager yet and is suitable for use as a file name (e.g. for the repository&#39;s data
&nbsp;	 * directory).
&nbsp;	 *
&nbsp;	 * @param baseName The String on which the returned ID should be based, must not be &lt;var&gt;null&lt;/var&gt;.
&nbsp;	 * @return A new repository ID derived from the specified base name.
&nbsp;	 * @throws RepositoryException
&nbsp;	 * @throws RepositoryConfigException
&nbsp;	 */
&nbsp;	public String getNewRepositoryID(String baseName) throws RepositoryException, RepositoryConfigException {
<b class="nc">&nbsp;		if (baseName != null) {</b>
&nbsp;			// Filter exotic characters from the base name
<b class="nc">&nbsp;			baseName = baseName.trim();</b>
&nbsp;
<b class="nc">&nbsp;			int length = baseName.length();</b>
<b class="nc">&nbsp;			StringBuilder buffer = new StringBuilder(length);</b>
&nbsp;
<b class="nc">&nbsp;			for (char c : baseName.toCharArray()) {</b>
<b class="nc">&nbsp;				if (Character.isLetter(c) || Character.isDigit(c) || c == &#39;-&#39; || c == &#39;_&#39; || c == &#39;.&#39;) {</b>
&nbsp;					// Convert to lower case since file names are case insensitive on
&nbsp;					// some/most platforms
<b class="nc">&nbsp;					buffer.append(Character.toLowerCase(c));</b>
<b class="nc">&nbsp;				} else if (c != &#39;&quot;&#39; &amp;&amp; c != &#39;\&#39;&#39;) {</b>
<b class="nc">&nbsp;					buffer.append(&#39;-&#39;);</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			baseName = buffer.toString();</b>
&nbsp;		}
&nbsp;
&nbsp;		// First try if we can use the base name without an appended index
<b class="nc">&nbsp;		if (baseName != null &amp;&amp; baseName.length() &gt; 0 &amp;&amp; !hasRepositoryConfig(baseName)) {</b>
<b class="nc">&nbsp;			return baseName;</b>
&nbsp;		}
&nbsp;
&nbsp;		// When the base name is null or empty, generate one
<b class="nc">&nbsp;		if (baseName == null || baseName.length() == 0) {</b>
<b class="nc">&nbsp;			baseName = &quot;repository-&quot;;</b>
<b class="nc">&nbsp;		} else if (!baseName.endsWith(&quot;-&quot;)) {</b>
<b class="nc">&nbsp;			baseName += &quot;-&quot;;</b>
&nbsp;		}
&nbsp;
&nbsp;		// Keep appending numbers until we find an unused ID
<b class="nc">&nbsp;		int index = 2;</b>
<b class="nc">&nbsp;		while (hasRepositoryConfig(baseName + index)) {</b>
<b class="nc">&nbsp;			index++;</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		return baseName + index;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Get the IDs of all available repositories. Note that this is potentially slow as it may initialize all available
&nbsp;	 * repository configurations.
&nbsp;	 *
&nbsp;	 * @return a list of repository ID strings.
&nbsp;	 * @throws RepositoryException
&nbsp;	 * @see {@link #getInitializedRepositoryIDs()}
&nbsp;	 */
&nbsp;	public Set&lt;String&gt; getRepositoryIDs() throws RepositoryException {
<b class="nc">&nbsp;		Set&lt;String&gt; idSet = new LinkedHashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		getAllRepositoryInfos().forEach(info -&gt; {</b>
<b class="nc">&nbsp;			idSet.add(info.getId());</b>
&nbsp;		});
<b class="nc">&nbsp;		return idSet;</b>
&nbsp;	}
&nbsp;
&nbsp;	public boolean hasRepositoryConfig(String repositoryID) throws RepositoryException, RepositoryConfigException {
<b class="nc">&nbsp;		return getRepositoryInfo(repositoryID) != null;</b>
&nbsp;	}
&nbsp;
&nbsp;	public abstract RepositoryConfig getRepositoryConfig(String repositoryID)
&nbsp;			throws RepositoryConfigException, RepositoryException;
&nbsp;
&nbsp;	/**
&nbsp;	 * Adds or updates the configuration of a repository to the manager. The manager may already contain a configuration
&nbsp;	 * for a repository with the same ID as specified by &lt;var&gt;config&lt;/var&gt;, in which case all previous configuration
&nbsp;	 * data for that repository will be cleared before the new configuration is added.
&nbsp;	 *
&nbsp;	 * @param config The repository configuration that should be added to or updated in the manager.
&nbsp;	 * @throws RepositoryException       If the manager failed to update.
&nbsp;	 * @throws RepositoryConfigException If the manager doesn&#39;t know how to update a configuration due to inconsistent
&nbsp;	 *                                   configuration data. For example, this happens when there are multiple existing
&nbsp;	 *                                   configurations with the concerning ID.
&nbsp;	 */
&nbsp;	public abstract void addRepositoryConfig(RepositoryConfig config)
&nbsp;			throws RepositoryException, RepositoryConfigException;
&nbsp;
&nbsp;	/**
&nbsp;	 * Checks on whether the given repository is referred to by a
&nbsp;	 * {@link org.eclipse.rdf4j.repository.sail.ProxyRepository} configuration.
&nbsp;	 *
&nbsp;	 * @param repositoryID id to check
&nbsp;	 * @return true if there is no existing proxy reference to the given id, false otherwise
&nbsp;	 * @throws RepositoryException
&nbsp;	 */
&nbsp;	public boolean isSafeToRemove(String repositoryID) throws RepositoryException {
<b class="nc">&nbsp;		for (String id : getRepositoryIDs()) {</b>
<b class="nc">&nbsp;			RepositoryConfig config = getRepositoryConfig(id);</b>
<b class="nc">&nbsp;			Model model = new LinkedHashModel();</b>
<b class="nc">&nbsp;			config.export(model, Values.bnode());</b>
<b class="nc">&nbsp;			if (model.contains(null, PROXIED_ID, Values.literal(repositoryID))) {</b>
<b class="nc">&nbsp;				return false;</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
<b class="nc">&nbsp;		return true;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Removes the specified repository by deleting its configuration if such a configuration is present, and removing
&nbsp;	 * any persistent data associated with the repository. Returns &lt;var&gt;true&lt;/var&gt; if the specified repository
&nbsp;	 * configuration was actually present. &lt;strong&gt;NB this operation can not be undone!&lt;/strong&gt;
&nbsp;	 *
&nbsp;	 * @param repositoryID The ID of the repository that needs to be removed.
&nbsp;	 * @throws RepositoryException       If the manager failed to update the configuration.
&nbsp;	 * @throws RepositoryConfigException If the manager doesn&#39;t know how to remove a repository due to inconsistent
&nbsp;	 *                                   configuration data. For example, this can happen when there are multiple
&nbsp;	 *                                   existing configurations with the concerning ID.
&nbsp;	 */
&nbsp;	public boolean removeRepository(String repositoryID) throws RepositoryException, RepositoryConfigException {
<b class="nc">&nbsp;		logger.debug(&quot;Removing repository {}.&quot;, repositoryID);</b>
<b class="nc">&nbsp;		boolean isRemoved = hasRepositoryConfig(repositoryID);</b>
&nbsp;
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			if (isRemoved) {</b>
<b class="nc">&nbsp;				logger.debug(&quot;Shutdown repository {} after removal of configuration.&quot;, repositoryID);</b>
<b class="nc">&nbsp;				Repository repository = initializedRepositories.remove(repositoryID);</b>
&nbsp;
<b class="nc">&nbsp;				if (repository != null &amp;&amp; repository.isInitialized()) {</b>
<b class="nc">&nbsp;					repository.shutDown();</b>
&nbsp;				}
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return isRemoved;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Gets the repository that is known by the specified ID from this manager.
&nbsp;	 *
&nbsp;	 * @param identity A repository ID.
&nbsp;	 * @return An initialized Repository object, or &lt;var&gt;null&lt;/var&gt; if no repository was known for the specified ID.
&nbsp;	 * @throws RepositoryConfigException If no repository could be created due to invalid or incomplete configuration
&nbsp;	 *                                   data.
&nbsp;	 */
&nbsp;	@Override
&nbsp;	public Repository getRepository(String identity) throws RepositoryConfigException, RepositoryException {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			Repository result = initializedRepositories.get(identity);</b>
&nbsp;
<b class="nc">&nbsp;			if (result != null &amp;&amp; !result.isInitialized()) {</b>
&nbsp;				// repository exists but has been shut down. throw away the old
&nbsp;				// object so we can re-read from the config.
<b class="nc">&nbsp;				initializedRepositories.remove(identity);</b>
<b class="nc">&nbsp;				result = null;</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			if (result == null) {</b>
&nbsp;				// First call (or old object thrown away), create and initialize the
&nbsp;				// repository.
<b class="nc">&nbsp;				result = createRepository(identity);</b>
&nbsp;
<b class="nc">&nbsp;				if (result != null) {</b>
<b class="nc">&nbsp;					initializedRepositories.put(identity, result);</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			return result;</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Returns all initialized repositories. This method returns fast as no lazy creation of repositories takes place.
&nbsp;	 *
&nbsp;	 * @return a collection containing the IDs of all initialized repositories.
&nbsp;	 * @see #getRepositoryIDs()
&nbsp;	 */
&nbsp;	public Set&lt;String&gt; getInitializedRepositoryIDs() {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			return new HashSet&lt;&gt;(initializedRepositories.keySet());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Returns all initialized repositories. This method returns fast as no lazy creation of repositories takes place.
&nbsp;	 *
&nbsp;	 * @return a set containing the initialized repositories.
&nbsp;	 * @see #getAllRepositories()
&nbsp;	 */
&nbsp;	public Collection&lt;Repository&gt; getInitializedRepositories() {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			return new ArrayList&lt;&gt;(initializedRepositories.values());</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	Repository getInitializedRepository(String repositoryID) {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			return initializedRepositories.get(repositoryID);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	Repository removeInitializedRepository(String repositoryID) {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			return initializedRepositories.remove(repositoryID);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	protected void setInitializedRepositories(Map&lt;String, Repository&gt; nextInitializedRepositories) {
<b class="nc">&nbsp;		initializedRepositories = nextInitializedRepositories;</b>
&nbsp;	}
&nbsp;
&nbsp;	protected void updateInitializedRepositories() {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			Iterator&lt;Repository&gt; iter = initializedRepositories.values().iterator();</b>
<b class="nc">&nbsp;			while (iter.hasNext()) {</b>
<b class="nc">&nbsp;				Repository next = iter.next();</b>
<b class="nc">&nbsp;				if (!next.isInitialized()) {</b>
<b class="nc">&nbsp;					iter.remove();</b>
&nbsp;					try {
<b class="nc">&nbsp;						next.shutDown();</b>
<b class="nc">&nbsp;					} catch (RepositoryException e) {</b>
&nbsp;
<b class="nc">&nbsp;					}</b>
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Returns all configured repositories. This may be an expensive operation as it initializes repositories that have
&nbsp;	 * not been initialized yet.
&nbsp;	 *
&nbsp;	 * @return The Set of all configured Repositories.
&nbsp;	 * @see #getInitializedRepositories()
&nbsp;	 */
&nbsp;	public Collection&lt;Repository&gt; getAllRepositories() throws RepositoryConfigException, RepositoryException {
<b class="nc">&nbsp;		Set&lt;String&gt; idSet = getRepositoryIDs();</b>
&nbsp;
<b class="nc">&nbsp;		ArrayList&lt;Repository&gt; result = new ArrayList&lt;&gt;(idSet.size());</b>
&nbsp;
<b class="nc">&nbsp;		for (String id : idSet) {</b>
<b class="nc">&nbsp;			result.add(getRepository(id));</b>
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return result;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Creates and initializes the repository with the specified ID.
&nbsp;	 *
&nbsp;	 * @param id A repository ID.
&nbsp;	 * @return The created and initialized repository, or &lt;var&gt;null&lt;/var&gt; if no such repository exists.
&nbsp;	 * @throws RepositoryConfigException If no repository could be created due to invalid or incomplete configuration
&nbsp;	 *                                   data.
&nbsp;	 * @throws RepositoryException       If the repository could not be initialized.
&nbsp;	 */
&nbsp;	protected abstract Repository createRepository(String id) throws RepositoryConfigException, RepositoryException;
&nbsp;
&nbsp;	/**
&nbsp;	 * Gets the repository that is known by the specified ID from this manager.
&nbsp;	 *
&nbsp;	 * @param id A repository ID.
&nbsp;	 * @return A Repository object, or &lt;var&gt;null&lt;/var&gt; if no repository was known for the specified ID.
&nbsp;	 * @throws RepositoryException When not able to retrieve existing configurations
&nbsp;	 */
&nbsp;	public RepositoryInfo getRepositoryInfo(String id) throws RepositoryException {
<b class="nc">&nbsp;		for (RepositoryInfo repInfo : getAllRepositoryInfos()) {</b>
<b class="nc">&nbsp;			if (repInfo.getId().equals(id)) {</b>
<b class="nc">&nbsp;				return repInfo;</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Retrieve meta information of all configured repositories.
&nbsp;	 *
&nbsp;	 * @return a collection of {@link RepositoryInfo} objects
&nbsp;	 * @throws RepositoryException if the repository meta information could not be retrieved.
&nbsp;	 */
&nbsp;	public abstract Collection&lt;RepositoryInfo&gt; getAllRepositoryInfos() throws RepositoryException;
&nbsp;
&nbsp;	/**
&nbsp;	 * @deprecated since 4.0 - use {@link #getAllRepositoryInfos()} instead.
&nbsp;	 */
&nbsp;	@Deprecated
&nbsp;	public Collection&lt;RepositoryInfo&gt; getAllUserRepositoryInfos() throws RepositoryException {
<b class="nc">&nbsp;		return getAllRepositoryInfos();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * @deprecated since 4.0 - use {@link #getAllRepositoryInfos()} instead.
&nbsp;	 */
&nbsp;	@Deprecated
&nbsp;	public Collection&lt;RepositoryInfo&gt; getAllRepositoryInfos(boolean skipSystemRepo) throws RepositoryException {
<b class="nc">&nbsp;		return getAllRepositoryInfos();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Shuts down all initialized user repositories.
&nbsp;	 *
&nbsp;	 * @see #shutDown()
&nbsp;	 */
&nbsp;	public void refresh() {
<b class="nc">&nbsp;		logger.debug(&quot;Refreshing repository information in manager...&quot;);</b>
&nbsp;
&nbsp;		// FIXME: uninitialized, removed repositories won&#39;t be cleaned up.
&nbsp;		try {
<b class="nc">&nbsp;			synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;				Iterator&lt;Map.Entry&lt;String, Repository&gt;&gt; iter = initializedRepositories.entrySet().iterator();</b>
&nbsp;
<b class="nc">&nbsp;				while (iter.hasNext()) {</b>
<b class="nc">&nbsp;					Map.Entry&lt;String, Repository&gt; entry = iter.next();</b>
<b class="nc">&nbsp;					String repositoryID = entry.getKey();</b>
<b class="nc">&nbsp;					Repository repository = entry.getValue();</b>
&nbsp;
&nbsp;					// remove from initialized repositories
<b class="nc">&nbsp;					iter.remove();</b>
&nbsp;					// refresh single repository
<b class="nc">&nbsp;					refreshRepository(repositoryID, repository);</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;		} catch (RepositoryException re) {</b>
<b class="nc">&nbsp;			logger.error(&quot;Failed to refresh repositories&quot;, re);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Shuts down all initialized repositories.
&nbsp;	 *
&nbsp;	 * @see #refresh()
&nbsp;	 */
&nbsp;	public void shutDown() {
<b class="nc">&nbsp;		synchronized (initializedRepositories) {</b>
<b class="nc">&nbsp;			updateInitializedRepositories();</b>
<b class="nc">&nbsp;			for (Repository repository : initializedRepositories.values()) {</b>
&nbsp;				try {
<b class="nc">&nbsp;					if (repository.isInitialized()) {</b>
<b class="nc">&nbsp;						repository.shutDown();</b>
&nbsp;					}
<b class="nc">&nbsp;				} catch (RepositoryException e) {</b>
<b class="nc">&nbsp;					logger.error(&quot;Repository shut down failed&quot;, e);</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			initializedRepositories.clear();</b>
<b class="nc">&nbsp;			initialized = false;</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	void refreshRepository(String repositoryID, Repository repository) {
<b class="nc">&nbsp;		logger.debug(&quot;Refreshing repository {}...&quot;, repositoryID);</b>
&nbsp;		try {
<b class="nc">&nbsp;			if (repository.isInitialized()) {</b>
<b class="nc">&nbsp;				repository.shutDown();</b>
&nbsp;			}
<b class="nc">&nbsp;		} catch (RepositoryException e) {</b>
<b class="nc">&nbsp;			logger.error(&quot;Failed to shut down repository&quot;, e);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Gets the URL of the server or directory.
&nbsp;	 *
&nbsp;	 * @throws MalformedURLException If the location cannot be represented as a URL.
&nbsp;	 */
&nbsp;	public abstract URL getLocation() throws MalformedURLException;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-09-18 08:22</div>
</div>
</body>
</html>
