


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ZeroLengthPathIteration</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.eclipse.rdf4j.query.algebra.evaluation.iterator</a>
</div>

<h1>Coverage Summary for Class: ZeroLengthPathIteration (org.eclipse.rdf4j.query.algebra.evaluation.iterator)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ZeroLengthPathIteration</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    80.6%
  </span>
  <span class="absValue">
    (29/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    96.9%
  </span>
  <span class="absValue">
    (63/65)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*******************************************************************************
&nbsp; * Copyright (c) 2015 Eclipse RDF4J contributors, Aduna, and others.
&nbsp; *
&nbsp; * All rights reserved. This program and the accompanying materials
&nbsp; * are made available under the terms of the Eclipse Distribution License v1.0
&nbsp; * which accompanies this distribution, and is available at
&nbsp; * http://www.eclipse.org/org/documents/edl-v10.php.
&nbsp; *
&nbsp; * SPDX-License-Identifier: BSD-3-Clause
&nbsp; *******************************************************************************/
&nbsp;package org.eclipse.rdf4j.query.algebra.evaluation.iterator;
&nbsp;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.BiConsumer;
&nbsp;
&nbsp;import org.eclipse.rdf4j.common.iteration.CloseableIteration;
&nbsp;import org.eclipse.rdf4j.common.iteration.LookAheadIteration;
&nbsp;import org.eclipse.rdf4j.model.Literal;
&nbsp;import org.eclipse.rdf4j.model.Value;
&nbsp;import org.eclipse.rdf4j.model.impl.SimpleValueFactory;
&nbsp;import org.eclipse.rdf4j.query.BindingSet;
&nbsp;import org.eclipse.rdf4j.query.MutableBindingSet;
&nbsp;import org.eclipse.rdf4j.query.QueryEvaluationException;
&nbsp;import org.eclipse.rdf4j.query.algebra.StatementPattern;
&nbsp;import org.eclipse.rdf4j.query.algebra.StatementPattern.Scope;
&nbsp;import org.eclipse.rdf4j.query.algebra.Var;
&nbsp;import org.eclipse.rdf4j.query.algebra.evaluation.EvaluationStrategy;
&nbsp;import org.eclipse.rdf4j.query.algebra.evaluation.QueryBindingSet;
&nbsp;import org.eclipse.rdf4j.query.algebra.evaluation.QueryEvaluationStep;
&nbsp;import org.eclipse.rdf4j.query.algebra.evaluation.impl.QueryEvaluationContext;
&nbsp;
&nbsp;public class ZeroLengthPathIteration extends LookAheadIteration&lt;BindingSet, QueryEvaluationException&gt; {
&nbsp;
<b class="fc">&nbsp;	private static final Literal OBJECT = SimpleValueFactory.getInstance().createLiteral(&quot;object&quot;);</b>
&nbsp;
<b class="fc">&nbsp;	private static final Literal SUBJECT = SimpleValueFactory.getInstance().createLiteral(&quot;subject&quot;);</b>
&nbsp;
&nbsp;	public static final String ANON_SUBJECT_VAR = &quot;zero-length-internal-start&quot;;
&nbsp;
&nbsp;	public static final String ANON_PREDICATE_VAR = &quot;zero-length-internal-pred&quot;;
&nbsp;
&nbsp;	public static final String ANON_OBJECT_VAR = &quot;zero-length-internal-end&quot;;
&nbsp;
&nbsp;	public static final String ANON_SEQUENCE_VAR = &quot;zero-length-internal-seq&quot;;
&nbsp;
&nbsp;	private QueryBindingSet result;
&nbsp;
&nbsp;	private final Value subj;
&nbsp;
&nbsp;	private final Value obj;
&nbsp;
&nbsp;	private final BindingSet bindings;
&nbsp;
&nbsp;	private CloseableIteration&lt;BindingSet, QueryEvaluationException&gt; iter;
&nbsp;
&nbsp;	private Set&lt;Value&gt; reportedValues;
&nbsp;
&nbsp;	private final Var contextVar;
&nbsp;
&nbsp;	private final EvaluationStrategy evaluationStrategy;
&nbsp;
&nbsp;	private final QueryEvaluationStep precompile;
&nbsp;
&nbsp;	private final QueryEvaluationContext context;
&nbsp;
&nbsp;	private final BiConsumer&lt;Value, MutableBindingSet&gt; setSubject;
&nbsp;
&nbsp;	private final BiConsumer&lt;Value, MutableBindingSet&gt; setObject;
&nbsp;
&nbsp;	private final BiConsumer&lt;Value, MutableBindingSet&gt; setContext;
&nbsp;
&nbsp;	public ZeroLengthPathIteration(EvaluationStrategy evaluationStrategyImpl, Var subjectVar, Var objVar, Value subj,
<b class="fc">&nbsp;			Value obj, Var contextVar, BindingSet bindings, QueryEvaluationContext context) {</b>
<b class="fc">&nbsp;		this.evaluationStrategy = evaluationStrategyImpl;</b>
<b class="fc">&nbsp;		this.context = context;</b>
<b class="fc">&nbsp;		this.result = new QueryBindingSet(bindings);</b>
<b class="fc">&nbsp;		this.contextVar = contextVar;</b>
<b class="fc">&nbsp;		this.subj = subj;</b>
<b class="fc">&nbsp;		this.obj = obj;</b>
<b class="fc">&nbsp;		this.bindings = bindings;</b>
<b class="fc">&nbsp;		Var startVar = createAnonVar(ANON_SUBJECT_VAR);</b>
<b class="fc">&nbsp;		Var predicate = createAnonVar(ANON_PREDICATE_VAR);</b>
<b class="fc">&nbsp;		Var endVar = createAnonVar(ANON_OBJECT_VAR);</b>
&nbsp;
&nbsp;		StatementPattern subjects;
<b class="fc">&nbsp;		if (contextVar != null) {</b>
<b class="fc">&nbsp;			subjects = new StatementPattern(Scope.NAMED_CONTEXTS, startVar, predicate, endVar, contextVar.clone());</b>
&nbsp;		} else {
<b class="fc">&nbsp;			subjects = new StatementPattern(startVar, predicate, endVar);</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		precompile = evaluationStrategy.precompile(subjects, context);</b>
<b class="fc">&nbsp;		setSubject = context.addBinding(subjectVar.getName());</b>
<b class="fc">&nbsp;		setObject = context.addBinding(objVar.getName());</b>
<b class="fc">&nbsp;		if (contextVar != null) {</b>
<b class="fc">&nbsp;			setContext = context.addBinding(contextVar.getName());</b>
&nbsp;		} else {
<b class="fc">&nbsp;			setContext = null;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	protected BindingSet getNextElement() throws QueryEvaluationException {
<b class="fc">&nbsp;		if (subj == null &amp;&amp; obj == null) {</b>
<b class="fc">&nbsp;			if (this.reportedValues == null) {</b>
<b class="fc">&nbsp;				reportedValues = evaluationStrategy.makeSet();</b>
&nbsp;			}
<b class="fc">&nbsp;			if (this.iter == null) {</b>
&nbsp;				// join with a sequence so we iterate over every entry twice
<b class="fc">&nbsp;				QueryBindingSet bs1 = new QueryBindingSet(1);</b>
<b class="fc">&nbsp;				bs1.addBinding(ANON_SEQUENCE_VAR, SUBJECT);</b>
<b class="fc">&nbsp;				QueryBindingSet bs2 = new QueryBindingSet(1);</b>
<b class="fc">&nbsp;				bs2.addBinding(ANON_SEQUENCE_VAR, OBJECT);</b>
<b class="fc">&nbsp;				List&lt;BindingSet&gt; seqList = Arrays.&lt;BindingSet&gt;asList(bs1, bs2);</b>
<b class="fc">&nbsp;				iter = new CrossProductIteration(createIteration(), seqList);</b>
&nbsp;			}
&nbsp;
<b class="fc">&nbsp;			while (iter.hasNext()) {</b>
<b class="fc">&nbsp;				BindingSet bs = iter.next();</b>
&nbsp;
<b class="fc">&nbsp;				boolean isSubjOrObj = bs.getValue(ANON_SEQUENCE_VAR).stringValue().equals(&quot;subject&quot;);</b>
<b class="fc">&nbsp;				String endpointVarName = isSubjOrObj ? ANON_SUBJECT_VAR : ANON_OBJECT_VAR;</b>
<b class="fc">&nbsp;				Value v = bs.getValue(endpointVarName);</b>
&nbsp;
<b class="fc">&nbsp;				if (reportedValues.add(v)) {</b>
<b class="fc">&nbsp;					MutableBindingSet next = context.createBindingSet(bindings);</b>
<b class="fc">&nbsp;					setSubject.accept(v, next);</b>
<b class="fc">&nbsp;					setObject.accept(v, next);</b>
<b class="fc">&nbsp;					if (setContext != null) {</b>
<b class="fc">&nbsp;						Value context = bs.getValue(contextVar.getName());</b>
<b class="fc">&nbsp;						if (context != null) {</b>
<b class="fc">&nbsp;							setContext.accept(context, next);</b>
&nbsp;						}
&nbsp;					}
<b class="fc">&nbsp;					return next;</b>
&nbsp;				}
<b class="fc">&nbsp;			}</b>
<b class="fc">&nbsp;			iter.close();</b>
&nbsp;
&nbsp;			// if we&#39;re done, throw away the cached list of values to avoid hogging
&nbsp;			// resources
<b class="fc">&nbsp;			reportedValues = null;</b>
<b class="fc">&nbsp;			return null;</b>
&nbsp;		} else {
<b class="fc">&nbsp;			if (result != null) {</b>
<b class="pc">&nbsp;				if (obj == null &amp;&amp; subj != null) {</b>
<b class="fc">&nbsp;					setObject.accept(subj, result);</b>
<b class="pc">&nbsp;				} else if (subj == null &amp;&amp; obj != null) {</b>
<b class="fc">&nbsp;					setSubject.accept(obj, result);</b>
<b class="nc">&nbsp;				} else if (subj != null &amp;&amp; subj.equals(obj)) {</b>
&nbsp;					// empty bindings
&nbsp;					// (result but nothing to bind as subjectVar and objVar are both fixed)
&nbsp;				} else {
<b class="nc">&nbsp;					result = null;</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="fc">&nbsp;			QueryBindingSet next = result;</b>
<b class="fc">&nbsp;			result = null;</b>
<b class="fc">&nbsp;			return next;</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private CloseableIteration&lt;BindingSet, QueryEvaluationException&gt; createIteration() throws QueryEvaluationException {
<b class="fc">&nbsp;		CloseableIteration&lt;BindingSet, QueryEvaluationException&gt; iter = precompile.evaluate(bindings);</b>
<b class="fc">&nbsp;		return iter;</b>
&nbsp;	}
&nbsp;
&nbsp;	public Var createAnonVar(String varName) {
<b class="fc">&nbsp;		Var var = new Var(varName);</b>
<b class="fc">&nbsp;		var.setAnonymous(true);</b>
<b class="fc">&nbsp;		return var;</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-09-18 08:22</div>
</div>
</body>
</html>
