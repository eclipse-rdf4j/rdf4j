


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > CombinedShapeSource</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.eclipse.rdf4j.sail.shacl.wrapper.shape</a>
</div>

<h1>Coverage Summary for Class: CombinedShapeSource (org.eclipse.rdf4j.sail.shacl.wrapper.shape)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CombinedShapeSource</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/46)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*******************************************************************************
&nbsp; * Copyright (c) 2022 Eclipse RDF4J contributors.
&nbsp; *
&nbsp; * All rights reserved. This program and the accompanying materials
&nbsp; * are made available under the terms of the Eclipse Distribution License v1.0
&nbsp; * which accompanies this distribution, and is available at
&nbsp; * http://www.eclipse.org/org/documents/edl-v10.php.
&nbsp; *
&nbsp; * SPDX-License-Identifier: BSD-3-Clause
&nbsp; *******************************************************************************/
&nbsp;package org.eclipse.rdf4j.sail.shacl.wrapper.shape;
&nbsp;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.stream.Stream;
&nbsp;
&nbsp;import org.eclipse.rdf4j.model.IRI;
&nbsp;import org.eclipse.rdf4j.model.Resource;
&nbsp;import org.eclipse.rdf4j.model.Statement;
&nbsp;import org.eclipse.rdf4j.model.Value;
&nbsp;import org.eclipse.rdf4j.model.vocabulary.RDF4J;
&nbsp;import org.eclipse.rdf4j.repository.RepositoryConnection;
&nbsp;import org.eclipse.rdf4j.sail.SailConnection;
&nbsp;
<b class="nc">&nbsp;public class CombinedShapeSource implements ShapeSource {</b>
&nbsp;
&nbsp;	private final ForwardChainingShapeSource rdf4jShapesGraph;
&nbsp;	private final BackwardChainingShapeSource baseSail;
&nbsp;	private final Resource[] context;
&nbsp;
&nbsp;	public CombinedShapeSource(RepositoryConnection shapesForForwardChainingConnection,
&nbsp;			SailConnection sailConnection) {
<b class="nc">&nbsp;		this(shapesForForwardChainingConnection, sailConnection, null);</b>
&nbsp;	}
&nbsp;
&nbsp;	private CombinedShapeSource(RepositoryConnection shapesForForwardChainingConnection,
&nbsp;			SailConnection sailConnection,
<b class="nc">&nbsp;			Resource[] context) {</b>
<b class="nc">&nbsp;		this.rdf4jShapesGraph = new ForwardChainingShapeSource(shapesForForwardChainingConnection);</b>
<b class="nc">&nbsp;		this.baseSail = new BackwardChainingShapeSource(sailConnection);</b>
<b class="nc">&nbsp;		this.context = context;</b>
&nbsp;	}
&nbsp;
&nbsp;	private CombinedShapeSource(ForwardChainingShapeSource rdf4jShapesGraph, BackwardChainingShapeSource baseSail,
<b class="nc">&nbsp;			Resource[] context) {</b>
<b class="nc">&nbsp;		this.rdf4jShapesGraph = rdf4jShapesGraph;</b>
<b class="nc">&nbsp;		this.baseSail = baseSail;</b>
<b class="nc">&nbsp;		this.context = context;</b>
&nbsp;	}
&nbsp;
&nbsp;	public ShapeSource withContext(Resource[] context) {
<b class="nc">&nbsp;		boolean contextContainRdf4jShapeGraph = false;</b>
<b class="nc">&nbsp;		boolean contextContainsOtherShapesGraph = false;</b>
<b class="nc">&nbsp;		for (Resource resource : context) {</b>
<b class="nc">&nbsp;			if (RDF4J.SHACL_SHAPE_GRAPH.equals(resource)) {</b>
<b class="nc">&nbsp;				contextContainRdf4jShapeGraph = true;</b>
&nbsp;			} else {
<b class="nc">&nbsp;				contextContainsOtherShapesGraph = true;</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		if (contextContainRdf4jShapeGraph &amp;&amp; !contextContainsOtherShapesGraph) {</b>
<b class="nc">&nbsp;			return rdf4jShapesGraph.withContext(context);</b>
<b class="nc">&nbsp;		} else if (!contextContainRdf4jShapeGraph &amp;&amp; contextContainsOtherShapesGraph) {</b>
<b class="nc">&nbsp;			return baseSail.withContext(context);</b>
&nbsp;		} else {
<b class="nc">&nbsp;			Resource[] context1 = { RDF4J.SHACL_SHAPE_GRAPH };</b>
<b class="nc">&nbsp;			Resource[] context2 = Arrays.stream(context)</b>
<b class="nc">&nbsp;					.filter(c -&gt; !RDF4J.SHACL_SHAPE_GRAPH.equals(c))</b>
<b class="nc">&nbsp;					.toArray(Resource[]::new);</b>
<b class="nc">&nbsp;			return new CombinedShapeSource(rdf4jShapesGraph.withContext(context1), baseSail.withContext(context2),</b>
&nbsp;					context);
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public Resource[] getActiveContexts() {
<b class="nc">&nbsp;		return context;</b>
&nbsp;	}
&nbsp;
&nbsp;	public Stream&lt;ShapesGraph&gt; getAllShapeContexts() {
<b class="nc">&nbsp;		return Stream.concat(rdf4jShapesGraph.getAllShapeContexts(), baseSail.getAllShapeContexts());</b>
&nbsp;	}
&nbsp;
&nbsp;	public Stream&lt;Resource&gt; getTargetableShape() {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		return Stream.concat(rdf4jShapesGraph.getTargetableShape(), baseSail.getTargetableShape()).distinct();</b>
&nbsp;	}
&nbsp;
&nbsp;	public boolean isType(Resource subject, IRI type) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		return rdf4jShapesGraph.isType(subject, type) || baseSail.isType(subject, type);</b>
&nbsp;	}
&nbsp;
&nbsp;	public Stream&lt;Resource&gt; getSubjects(Predicates predicate) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		return Stream.concat(rdf4jShapesGraph.getSubjects(predicate), baseSail.getSubjects(predicate)).distinct();</b>
&nbsp;	}
&nbsp;
&nbsp;	public Stream&lt;Value&gt; getObjects(Resource subject, Predicates predicate) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		return Stream.concat(rdf4jShapesGraph.getObjects(subject, predicate), baseSail.getObjects(subject, predicate))</b>
<b class="nc">&nbsp;				.distinct();</b>
&nbsp;	}
&nbsp;
&nbsp;	public Stream&lt;Statement&gt; getAllStatements(Resource id) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		return Stream.concat(rdf4jShapesGraph.getAllStatements(id), baseSail.getAllStatements(id)).distinct();</b>
&nbsp;	}
&nbsp;
&nbsp;	public Value getRdfFirst(Resource subject) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		Value rdfFirst1 = rdf4jShapesGraph.getRdfFirst(subject);</b>
<b class="nc">&nbsp;		return rdfFirst1 != null ? rdfFirst1 : baseSail.getRdfFirst(subject);</b>
&nbsp;	}
&nbsp;
&nbsp;	public Resource getRdfRest(Resource subject) {
<b class="nc">&nbsp;		assert context != null;</b>
<b class="nc">&nbsp;		Value rdfRest1 = rdf4jShapesGraph.getRdfRest(subject);</b>
<b class="nc">&nbsp;		return (Resource) (rdfRest1 != null ? rdfRest1 : baseSail.getRdfRest(subject));</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void close() {
<b class="nc">&nbsp;		rdf4jShapesGraph.close();</b>
<b class="nc">&nbsp;		baseSail.close();</b>
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-09-18 08:22</div>
</div>
</body>
</html>
