/*******************************************************************************
 * Copyright (c) 2026 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.query.algebra.evaluation.optimizer;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.time.Duration;

import org.junit.jupiter.api.Test;

class MemoryJoinStatsBaselineDriftInvalidationTest {

	@Test
	void invalidatesWhenDefaultCardinalityDrifts() {
		PatternKey key = new PatternKey(null, PatternKey.SUBJECT_BOUND);
		MemoryJoinStats.InvalidationSettings settings = MemoryJoinStats.InvalidationSettings.of(Duration.ofMinutes(5),
				10);
		MemoryJoinStats stats = new MemoryJoinStats(settings);
		stats.seedIfAbsent(key, 10.0d, 2);
		stats.recordCall(key);
		stats.recordResults(key, 10);
		assertEquals(10.0d, stats.getAverageResults(key), 0.0001d);

		stats.seedIfAbsent(key, 100.0d, 2);
		assertEquals(100.0d, stats.getAverageResults(key), 0.0001d);
	}
}
