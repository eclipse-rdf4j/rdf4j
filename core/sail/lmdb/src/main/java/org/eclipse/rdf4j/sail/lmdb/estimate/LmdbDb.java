/*******************************************************************************
 * Copyright (c) 2026 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.sail.lmdb.estimate;

import java.nio.ByteBuffer;

final class LmdbDb {

	final int pad;
	final int flags;
	final int depth;
	final long branchPages;
	final long leafPages;
	final long overflowPages;
	final long entries;
	final long rootPgno;

	LmdbDb(int pad, int flags, int depth, long branchPages, long leafPages, long overflowPages, long entries,
			long rootPgno) {
		this.pad = pad;
		this.flags = flags;
		this.depth = depth;
		this.branchPages = branchPages;
		this.leafPages = leafPages;
		this.overflowPages = overflowPages;
		this.entries = entries;
		this.rootPgno = rootPgno;
	}

	boolean isEmpty() {
		return rootPgno == LmdbFormat.P_INVALID || entries == 0;
	}

	static LmdbDb parse(ByteBuffer buffer, int offset) {
		int pad = buffer.getInt(offset + LmdbFormat.MDB_DB_PAD_OFFSET);
		int flags = LmdbFormat.unsignedShort(buffer, offset + LmdbFormat.MDB_DB_FLAGS_OFFSET);
		int depth = LmdbFormat.unsignedShort(buffer, offset + LmdbFormat.MDB_DB_DEPTH_OFFSET);
		long branchPages = buffer.getLong(offset + LmdbFormat.MDB_DB_BRANCH_PAGES_OFFSET);
		long leafPages = buffer.getLong(offset + LmdbFormat.MDB_DB_LEAF_PAGES_OFFSET);
		long overflowPages = buffer.getLong(offset + LmdbFormat.MDB_DB_OVERFLOW_PAGES_OFFSET);
		long entries = buffer.getLong(offset + LmdbFormat.MDB_DB_ENTRIES_OFFSET);
		long rootPgno = buffer.getLong(offset + LmdbFormat.MDB_DB_ROOT_OFFSET);
		return new LmdbDb(pad, flags, depth, branchPages, leafPages, overflowPages, entries, rootPgno);
	}

}
