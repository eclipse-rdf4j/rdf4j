PREFIX dcat: <http://www.w3.org/ns/dcat#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT ?dataset ?node ?value
WHERE {
    ?dataset a dcat:Dataset .

    # Alternating property path forces expansion before filtering
    ?dataset (dcat:distribution|dct:publisher|dcat:dataset)+ ?node .
    ?node ?p ?value .

    FILTER (!isLiteral(?node) || STRLEN(STR(?value)) > 3)
}
