/*******************************************************************************
 * Copyright (c) 2026 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex

package org.eclipse.rdf4j.sail.shacl;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

import org.eclipse.rdf4j.sail.shacl.ast.Shape;
import org.eclipse.rdf4j.sail.shacl.ast.planNodes.PlanNode;
import org.eclipse.rdf4j.sail.shacl.wrapper.data.ConnectionsGroup;
import org.junit.jupiter.api.Test;
import org.slf4j.LoggerFactory;

class ShapeValidationContainerLifecycleTest {

	@Test
	void emptyPlanShouldCloseOwnedConnectionsGroup() {
		Shape shape = mock(Shape.class);
		PlanNode planNode = mock(PlanNode.class);
		ConnectionsGroup connectionsGroup = mock(ConnectionsGroup.class);

		when(planNode.isGuaranteedEmpty()).thenReturn(true);

		ShapeValidationContainer container = new ShapeValidationContainer(
				shape,
				() -> planNode,
				false,
				false,
				1,
				false,
				false,
				LoggerFactory.getLogger(ShapeValidationContainerLifecycleTest.class),
				connectionsGroup,
				true);

		assertFalse(container.hasPlanNode());
		verify(connectionsGroup).close();
	}
}
