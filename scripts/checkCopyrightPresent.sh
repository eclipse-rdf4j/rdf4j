#!/bin/bash
filesWithOutCopyright=()
for i in $(find ../ -name pom.xml); do
  # only look in non test files but make sure src/main exists.
  # and not in package-info
  dir="${i/pom.xml/}src/"
  if [ -d "$dir" ]; then
    for c in $(find ${dir} -name *.java -not -name package-info.java -exec grep -L Copyright {} \;); do
      # skip a file that is generated by.
      f=$(grep -L 'Generated By:' $c)
      if [ ! -z $f ]; then
        filesWithOutCopyright+=($f)
      fi
    done
  fi
done

for f in ${filesWithOutCopyright[@]}; do
  echo "Missing copyright: $f"
done
if [ ${#filesWithOutCopyright[@]} -ne 0 ]; then
  exit 1
fi
