/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.benchmark.rio.util;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.lang.reflect.Method;

import org.eclipse.rdf4j.model.IRI;
import org.eclipse.rdf4j.model.Model;
import org.eclipse.rdf4j.model.util.Values;
import org.eclipse.rdf4j.model.vocabulary.RDF;
import org.junit.jupiter.api.Test;

class ThemeDataSetGeneratorTest {

	private static final String BASE = "http://example.com/theme/";

	@Test
	void medicalRecordsGeneratorProducesPatients() throws Exception {
		Model model = generateModel("medicalConfig", "generateMedicalRecords");
		IRI patientType = Values.iri(BASE, "medical/Patient");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, patientType));
	}

	@Test
	void socialMediaGeneratorProducesUsers() throws Exception {
		Model model = generateModel("socialMediaConfig", "generateSocialMedia");
		IRI userType = Values.iri(BASE, "social/User");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, userType));
	}

	@Test
	void socialMediaGeneratorProducesCliques() throws Exception {
		Model model = generateModel("socialMediaConfig", "generateSocialMedia");
		IRI follows = Values.iri(BASE, "social/follows");
		assertClique(model, follows, 0, 3);
		assertClique(model, follows, 3, 4);
		assertClique(model, follows, 7, 5);
		assertClique(model, follows, 12, 6);
	}

	@Test
	void libraryGeneratorProducesBooks() throws Exception {
		Model model = generateModel("libraryConfig", "generateLibrary");
		IRI bookType = Values.iri(BASE, "library/Book");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, bookType));
	}

	@Test
	void engineeringGeneratorProducesComponents() throws Exception {
		Model model = generateModel("engineeringConfig", "generateEngineering");
		IRI componentType = Values.iri(BASE, "engineering/Component");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, componentType));
	}

	@Test
	void highlyConnectedGeneratorProducesNodes() throws Exception {
		Model model = generateModel("highlyConnectedConfig", "generateHighlyConnected");
		IRI nodeType = Values.iri(BASE, "connected/Node");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, nodeType));
	}

	@Test
	void trainGeneratorProducesOperationalPoints() throws Exception {
		Model model = generateModel("trainConfig", "generateTrain");
		IRI operationalPointType = Values.iri(BASE, "train/OperationalPoint");
		IRI sectionType = Values.iri(BASE, "train/SectionOfLine");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, operationalPointType));
		assertTrue(model.contains(null, RDF.TYPE, sectionType));
	}

	@Test
	void electricalGridGeneratorProducesSubstations() throws Exception {
		Model model = generateModel("electricalGridConfig", "generateElectricalGrid");
		IRI substationType = Values.iri(BASE, "grid/Substation");
		assertFalse(model.isEmpty());
		assertTrue(model.contains(null, RDF.TYPE, substationType));
	}

	private static Model generateModel(String configMethodName, String generateMethodName) throws Exception {
		Class<?> generator = Class.forName("org.eclipse.rdf4j.benchmark.rio.util.ThemeDataSetGenerator");
		Object config = generator.getMethod(configMethodName).invoke(null);
		Method generate = generator.getMethod(generateMethodName, config.getClass());
		return (Model) generate.invoke(null, config);
	}

	private static void assertClique(Model model, IRI follows, int startId, int size) {
		for (int i = 0; i < size; i++) {
			IRI source = socialUser(startId + i);
			for (int j = 0; j < size; j++) {
				if (i == j) {
					continue;
				}
				IRI target = socialUser(startId + j);
				assertTrue(model.contains(source, follows, target),
						() -> "Missing follows edge " + source + " -> " + target);
			}
		}
	}

	private static IRI socialUser(int id) {
		return Values.iri(BASE, "social/user/" + id);
	}
}
