/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.benchmark.common;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.io.InputStream;
import java.lang.reflect.Method;
import java.nio.file.Files;
import java.nio.file.Path;

import org.apache.commons.io.FileUtils;
import org.eclipse.rdf4j.benchmark.rio.util.ThemeDataSetGenerator.Theme;
import org.eclipse.rdf4j.model.Model;
import org.eclipse.rdf4j.rio.RDFFormat;
import org.eclipse.rdf4j.rio.Rio;
import org.junit.jupiter.api.Test;

class ThemeDataSetCacheTest {

	@Test
	void cachesNQuadsToDisk() throws Exception {
		Path tempDir = Files.createTempDirectory("theme-cache");
		try {
			Class<?> cacheClass = Class.forName("org.eclipse.rdf4j.benchmark.common.ThemeDataSetCache");
			Method method = cacheClass.getMethod("getOrCreateNQuads", Theme.class, Path.class);
			Path cacheFile = (Path) method.invoke(null, Theme.SOCIAL_MEDIA, tempDir);
			assertNotNull(cacheFile, "Cache file should be returned");
			assertTrue(cacheFile.toString().endsWith(".nq"), "Cache should be a .nq file");
			assertTrue(Files.exists(cacheFile), "Cache file should exist");
			assertTrue(Files.size(cacheFile) > 0, "Cache file should be non-empty");
			try (InputStream input = Files.newInputStream(cacheFile)) {
				Model model = Rio.parse(input, "", RDFFormat.NQUADS);
				assertFalse(model.isEmpty(), "Cached model should have statements");
			}
		} finally {
			FileUtils.deleteDirectory(tempDir.toFile());
		}
	}
}
