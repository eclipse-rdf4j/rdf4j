/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.benchmark.common;

import java.util.EnumMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;

import org.eclipse.rdf4j.benchmark.rio.util.ThemeDataSetGenerator.Theme;

public final class ThemeQueryCatalog {

	public static final int QUERY_COUNT = 8;

	private static final Map<Theme, List<String>> QUERIES = new EnumMap<>(Theme.class);

	static {
		String medicalPrefix = String.join("\n",
				"PREFIX med: <http://example.com/theme/medical/>",
				"PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>",
				"");
		QUERIES.put(Theme.MEDICAL_RECORDS, List.of(
				medicalPrefix + "SELECT (COUNT(?p) AS ?count) WHERE { ?p a med:Patient . }",
				medicalPrefix + "SELECT (COUNT(?e) AS ?count) WHERE { ?e a med:Encounter . }",
				medicalPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?e a med:Encounter ; med:hasCondition ?c . }",
				medicalPrefix
						+ "SELECT (COUNT(?o) AS ?count) WHERE { ?o a med:Observation ; med:value ?v . FILTER(?v > 80) }",
				medicalPrefix + "SELECT (COUNT(?m) AS ?count) WHERE { ?p a med:Patient ; med:hasMedication ?m . }",
				medicalPrefix
						+ "SELECT (COUNT(?p) AS ?count) WHERE { ?p med:hasEncounter ?e . ?e med:handledBy ?pr . }",
				medicalPrefix
						+ "SELECT (COUNT(?p) AS ?count) WHERE { ?p med:hasEncounter ?e . ?e med:hasCondition ?c . ?c med:code ?code . }",
				medicalPrefix
						+ "SELECT (COUNT(?e) AS ?count) WHERE { ?e a med:Encounter ; med:recordedOn ?d . FILTER(?d >= \"2024-06-01\"^^xsd:date) }"));

		String socialPrefix = String.join("\n",
				"PREFIX social: <http://example.com/theme/social/>",
				"PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>",
				"");
		QUERIES.put(Theme.SOCIAL_MEDIA, List.of(
				socialPrefix + "SELECT (COUNT(?u) AS ?count) WHERE { ?u a social:User . }",
				socialPrefix + "SELECT (COUNT(?p) AS ?count) WHERE { ?p a social:Post . }",
				socialPrefix + "SELECT (COUNT(?p) AS ?count) WHERE { ?p a social:Post ; social:hasTag ?t . }",
				socialPrefix + "SELECT (COUNT(?p) AS ?count) WHERE { ?p a social:Post ; social:hasComment ?c . }",
				socialPrefix + "SELECT (COUNT(?u) AS ?count) WHERE { ?u a social:User ; social:follows ?other . }",
				socialPrefix + "SELECT (COUNT(?p) AS ?count) WHERE { ?p a social:Post ; social:likedBy ?u . }",
				socialPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?c a social:Comment ; social:authored ?u . }",
				socialPrefix
						+ "SELECT (COUNT(?p) AS ?count) WHERE { ?p a social:Post ; social:createdAt ?t . FILTER(?t > \"2024-01-15T00:00:00\"^^xsd:dateTime) }"));

		String libraryPrefix = String.join("\n",
				"PREFIX lib: <http://example.com/theme/library/>",
				"PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>",
				"");
		QUERIES.put(Theme.LIBRARY, List.of(
				libraryPrefix + "SELECT (COUNT(?b) AS ?count) WHERE { ?b a lib:Book . }",
				libraryPrefix + "SELECT (COUNT(?a) AS ?count) WHERE { ?a a lib:Author . }",
				libraryPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?c a lib:Copy . }",
				libraryPrefix + "SELECT (COUNT(?b) AS ?count) WHERE { ?b a lib:Book ; lib:hasCopy ?c . }",
				libraryPrefix + "SELECT (COUNT(?b) AS ?count) WHERE { ?b a lib:Book ; lib:writtenBy ?a . }",
				libraryPrefix + "SELECT (COUNT(?l) AS ?count) WHERE { ?l a lib:Loan ; lib:borrowedBy ?m . }",
				libraryPrefix
						+ "SELECT (COUNT(?l) AS ?count) WHERE { ?l a lib:Loan ; lib:dueDate ?d . FILTER(?d > \"2024-02-01\"^^xsd:date) }",
				libraryPrefix
						+ "SELECT (COUNT(?m) AS ?count) WHERE { ?m a lib:Member . ?l lib:borrowedBy ?m ; lib:loanedCopy ?c . ?b lib:hasCopy ?c . }"));

		String engineeringPrefix = String.join("\n",
				"PREFIX eng: <http://example.com/theme/engineering/>",
				"");
		QUERIES.put(Theme.ENGINEERING, List.of(
				engineeringPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?c a eng:Component . }",
				engineeringPrefix + "SELECT (COUNT(?a) AS ?count) WHERE { ?a a eng:Assembly . }",
				engineeringPrefix + "SELECT (COUNT(?r) AS ?count) WHERE { ?r a eng:Requirement . }",
				engineeringPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?c a eng:Component ; eng:partOf ?a . }",
				engineeringPrefix + "SELECT (COUNT(?c) AS ?count) WHERE { ?c eng:dependsOn ?d . }",
				engineeringPrefix + "SELECT (COUNT(?r) AS ?count) WHERE { ?r a eng:Requirement ; eng:satisfies ?c . }",
				engineeringPrefix + "SELECT (COUNT(?t) AS ?count) WHERE { ?r eng:verifiedBy ?t . }",
				engineeringPrefix
						+ "SELECT (COUNT(?m) AS ?count) WHERE { ?m a eng:Measurement ; eng:measuredValue ?v . FILTER(?v > 0.9) }"));

		String connectedPrefix = String.join("\n",
				"PREFIX conn: <http://example.com/theme/connected/>",
				"");
		QUERIES.put(Theme.HIGHLY_CONNECTED, List.of(
				connectedPrefix + "SELECT (COUNT(?n) AS ?count) WHERE { ?n a conn:Node . }",
				connectedPrefix + "SELECT (COUNT(?o) AS ?count) WHERE { ?s conn:connectsTo ?o . }",
				connectedPrefix + "SELECT (COUNT(?w) AS ?count) WHERE { ?s conn:weight ?w . }",
				connectedPrefix + "SELECT (COUNT(?s) AS ?count) WHERE { ?s conn:weight ?w . FILTER(?w > 5) }",
				connectedPrefix
						+ "SELECT (COUNT(?c) AS ?count) WHERE { ?a conn:connectsTo ?b . ?b conn:connectsTo ?c . }",
				connectedPrefix
						+ "SELECT (COUNT(?n) AS ?count) WHERE { SELECT ?n (COUNT(?t) AS ?deg) WHERE { ?n conn:connectsTo ?t } GROUP BY ?n HAVING(?deg > 5) }",
				connectedPrefix + "SELECT (COUNT(DISTINCT ?o) AS ?count) WHERE { ?s conn:connectsTo ?o . }",
				connectedPrefix
						+ "SELECT (COUNT(?s) AS ?count) WHERE { ?s conn:connectsTo ?o . ?o conn:connectsTo ?s . }"));

		String trainPrefix = String.join("\n",
				"PREFIX train: <http://example.com/theme/train/>",
				"PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>",
				"");
		QUERIES.put(Theme.TRAIN, List.of(
				trainPrefix + "SELECT (COUNT(?s) AS ?count) WHERE { ?s a train:Station . }",
				trainPrefix + "SELECT (COUNT(?r) AS ?count) WHERE { ?r a train:Route . }",
				trainPrefix + "SELECT (COUNT(?s) AS ?count) WHERE { ?s a train:Stop . }",
				trainPrefix + "SELECT (COUNT(?t) AS ?count) WHERE { ?t a train:Trip . }",
				trainPrefix + "SELECT (COUNT(?r) AS ?count) WHERE { ?r a train:Route ; train:hasStop ?s . }",
				trainPrefix + "SELECT (COUNT(?s) AS ?count) WHERE { ?s a train:Stop ; train:atStation ?station . }",
				trainPrefix + "SELECT (COUNT(?t) AS ?count) WHERE { ?train a train:Train ; train:hasTrip ?t . }",
				trainPrefix
						+ "SELECT (COUNT(?t) AS ?count) WHERE { ?t a train:Trip ; train:departureTime ?time . FILTER(?time > \"10:00:00\"^^xsd:time) }"));

		String gridPrefix = String.join("\n",
				"PREFIX grid: <http://example.com/theme/grid/>",
				"");
		QUERIES.put(Theme.ELECTRICAL_GRID, List.of(
				gridPrefix + "SELECT (COUNT(?s) AS ?count) WHERE { ?s a grid:Substation . }",
				gridPrefix + "SELECT (COUNT(?t) AS ?count) WHERE { ?t a grid:Transformer . }",
				gridPrefix + "SELECT (COUNT(?m) AS ?count) WHERE { ?m a grid:Meter . }",
				gridPrefix + "SELECT (COUNT(?l) AS ?count) WHERE { ?l a grid:Load . }",
				gridPrefix + "SELECT (COUNT(?m) AS ?count) WHERE { ?m a grid:Meter ; grid:measures ?load . }",
				gridPrefix + "SELECT (COUNT(?line) AS ?count) WHERE { ?line a grid:Line ; grid:connectsTo ?s . }",
				gridPrefix
						+ "SELECT (COUNT(?l) AS ?count) WHERE { ?l a grid:Load ; grid:loadValue ?v . FILTER(?v > 100) }",
				gridPrefix
						+ "SELECT (COUNT(?g) AS ?count) WHERE { ?g a grid:Generator ; grid:capacity ?c . FILTER(?c > 700) }"));

		validateQueries();
	}

	private ThemeQueryCatalog() {
	}

	public static List<String> queriesFor(Theme theme) {
		Objects.requireNonNull(theme, "theme");
		return QUERIES.get(theme);
	}

	public static String queryFor(Theme theme, int index) {
		Objects.requireNonNull(theme, "theme");
		List<String> queries = QUERIES.get(theme);
		if (queries == null) {
			throw new IllegalArgumentException("No queries registered for theme " + theme);
		}
		if (index < 0 || index >= queries.size()) {
			throw new IllegalArgumentException("Query index out of range: " + index);
		}
		return queries.get(index);
	}

	private static void validateQueries() {
		for (Theme theme : Theme.values()) {
			List<String> queries = QUERIES.get(theme);
			if (queries == null) {
				throw new IllegalStateException("Missing query list for theme " + theme);
			}
			if (queries.size() != QUERY_COUNT) {
				throw new IllegalStateException("Theme " + theme + " has " + queries.size() + " queries");
			}
		}
	}
}
