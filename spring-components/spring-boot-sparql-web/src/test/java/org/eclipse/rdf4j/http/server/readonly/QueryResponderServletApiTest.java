/*******************************************************************************
 * Copyright (c) 2026 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.http.server.readonly;

import static org.assertj.core.api.Assertions.assertThat;

import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.Arrays;

import org.junit.jupiter.api.Test;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

class QueryResponderServletApiTest {

	@Test
	void queryResponderUsesJakartaServletTypes() {
		Method post = findMethod(QueryResponder.class, "sparqlPostURLencoded");
		Method get = findMethod(QueryResponder.class, "sparqlGet");

		assertThat(post.getParameterTypes()[4]).as("POST request parameter should be jakarta servlet request")
				.isEqualTo(HttpServletRequest.class);
		assertThat(post.getParameterTypes()[5]).as("POST response parameter should be jakarta servlet response")
				.isEqualTo(HttpServletResponse.class);

		assertThat(get.getParameterTypes()[4]).as("GET request parameter should be jakarta servlet request")
				.isEqualTo(HttpServletRequest.class);
		assertThat(get.getParameterTypes()[5]).as("GET response parameter should be jakarta servlet response")
				.isEqualTo(HttpServletResponse.class);
	}

	@Test
	void evaluateResultWrapperUsesJakartaServletResponse() throws NoSuchFieldException {
		Field responseField = EvaluateResultHttpResponse.class.getDeclaredField("response");

		assertThat(responseField.getType()).as("Encapsulated response should be jakarta servlet response")
				.isEqualTo(HttpServletResponse.class);
	}

	private Method findMethod(Class<?> type, String name) {
		return Arrays.stream(type.getMethods())
				.filter(m -> m.getName().equals(name))
				.findFirst()
				.orElseThrow(() -> new AssertionError("Method " + name + " not found on " + type.getName()));
	}
}
