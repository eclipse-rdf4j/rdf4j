/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.sail.elasticsearch;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;

import java.util.Properties;

import org.eclipse.rdf4j.model.IRI;
import org.eclipse.rdf4j.model.ValueFactory;
import org.eclipse.rdf4j.model.impl.SimpleValueFactory;
import org.junit.jupiter.api.Test;

public class ElasticsearchIndexHttpTest extends AbstractElasticsearchTest {

	private static final ValueFactory VF = SimpleValueFactory.getInstance();

	@Test
	public void initializeAndIndexOverHttpEndpoint() {
		Properties props = new Properties();
		props.put(ElasticsearchIndex.TRANSPORT_KEY,
				elasticsearch.getHost() + ":" + elasticsearch.getMappedPort(9200));
		props.put(ElasticsearchIndex.ELASTICSEARCH_KEY_PREFIX + "cluster.name", CLUSTER_NAME);
		props.put(ElasticsearchIndex.INDEX_NAME_KEY, ElasticsearchTestUtils.getNextTestIndexName());
		props.put(ElasticsearchIndex.WAIT_FOR_STATUS_KEY, "yellow");

		IRI subject = VF.createIRI("urn:subj-http");
		IRI predicate = VF.createIRI("urn:pred-http");

		ElasticsearchIndex index = new ElasticsearchIndex();

		assertDoesNotThrow(() -> {
			index.initialize(props);
			try {
				index.begin();
				index.addStatement(VF.createStatement(subject, predicate, VF.createLiteral("value")));
				index.commit();
			} finally {
				index.shutDown();
			}
		});
	}
}
