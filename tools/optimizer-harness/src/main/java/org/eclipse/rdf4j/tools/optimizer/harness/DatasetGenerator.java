/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.tools.optimizer.harness;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;

import org.eclipse.rdf4j.model.IRI;
import org.eclipse.rdf4j.model.Literal;
import org.eclipse.rdf4j.model.Statement;
import org.eclipse.rdf4j.model.ValueFactory;
import org.eclipse.rdf4j.model.impl.SimpleValueFactory;

final class DatasetGenerator {

	static final String EX_NS = "http://example.com/";
	static final IRI P1 = SimpleValueFactory.getInstance().createIRI(EX_NS, "p1");
	static final IRI P2 = SimpleValueFactory.getInstance().createIRI(EX_NS, "p2");
	static final IRI P3 = SimpleValueFactory.getInstance().createIRI(EX_NS, "p3");

	private DatasetGenerator() {
	}

	static List<Statement> generate(HarnessConfig config) {
		ValueFactory vf = SimpleValueFactory.getInstance();
		Random random = new Random(config.seed);
		List<Statement> statements = new ArrayList<>(config.subjects * config.fanout);
		for (int s = 0; s < config.subjects; s++) {
			IRI subject = vf.createIRI(EX_NS, "s" + s);
			for (int i = 0; i < config.fanout; i++) {
				Literal object = literalForIndex(vf, random.nextInt(config.objects));
				statements.add(vf.createStatement(subject, P1, object));
			}
			if (random.nextDouble() < config.optionalRate) {
				Literal object = literalForIndex(vf, random.nextInt(config.objects));
				statements.add(vf.createStatement(subject, P2, object));
			}
			if (random.nextDouble() < config.unionSkew) {
				Literal object = literalForIndex(vf, random.nextInt(config.objects));
				statements.add(vf.createStatement(subject, P3, object));
			}
		}
		return statements;
	}

	private static Literal literalForIndex(ValueFactory vf, int index) {
		return vf.createLiteral(index);
	}
}
