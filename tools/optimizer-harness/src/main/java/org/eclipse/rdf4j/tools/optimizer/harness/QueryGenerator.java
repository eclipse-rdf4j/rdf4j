/*******************************************************************************
 * Copyright (c) 2025 Eclipse RDF4J contributors.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Distribution License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 *******************************************************************************/
// Some portions generated by Codex
package org.eclipse.rdf4j.tools.optimizer.harness;

import java.util.ArrayList;
import java.util.List;

final class QueryGenerator {

	private static final String PREFIX = "PREFIX ex: <" + DatasetGenerator.EX_NS + ">";

	private QueryGenerator() {
	}

	static List<QueryCase> generate(HarnessConfig config) {
		List<QueryCase> cases = new ArrayList<>();
		int filterLimit = config.filterThreshold();

		cases.add(new QueryCase(
				"optional-basic",
				"OPTIONAL basic join on ?s",
				PREFIX + "\nSELECT * WHERE {\n  ?s ex:p1 ?x .\n  OPTIONAL { ?s ex:p2 ?y . }\n}"));

		cases.add(new QueryCase(
				"optional-filter-inside",
				"OPTIONAL with filter inside referencing optional var",
				PREFIX + "\nSELECT * WHERE {\n  ?s ex:p1 ?x .\n  OPTIONAL { ?s ex:p2 ?y . FILTER(?y < " + filterLimit
						+ ") }\n}"));

		cases.add(new QueryCase(
				"optional-filter-outside",
				"FILTER outside OPTIONAL referencing optional var",
				PREFIX + "\nSELECT * WHERE {\n  ?s ex:p1 ?x .\n  OPTIONAL { ?s ex:p2 ?y . }\n  FILTER(?y < "
						+ filterLimit + ")\n}"));

		cases.add(new QueryCase(
				"union-skew",
				"UNION skew: second arm requires p3",
				PREFIX + "\nSELECT * WHERE {\n  { ?s ex:p1 ?x . }\n  UNION\n  { ?s ex:p1 ?x . ?s ex:p3 ?y . }\n}"));

		cases.add(new QueryCase(
				"union-different-vars",
				"UNION arms with different join variables",
				PREFIX + "\nSELECT * WHERE {\n  { ?s ex:p1 ?x . }\n  UNION\n  { ?t ex:p1 ?x . ?t ex:p3 ?z . }\n}"));

		cases.add(new QueryCase(
				"union-optional",
				"UNION + OPTIONAL interaction",
				PREFIX + "\nSELECT * WHERE {\n  { ?s ex:p1 ?x . } UNION { ?s ex:p3 ?z . }\n  OPTIONAL { ?s ex:p2 ?y . }\n}"));

		cases.add(new QueryCase(
				"union-nested",
				"Nested UNION to test flattening",
				PREFIX + "\nSELECT * WHERE {\n  { { ?s ex:p1 ?x . } UNION { ?s ex:p2 ?y . } }\n  UNION\n  { ?s ex:p3 ?z . }\n}"));

		cases.add(new QueryCase(
				"union-filter-arm",
				"FILTER in one UNION arm only",
				PREFIX + "\nSELECT * WHERE {\n  { ?s ex:p1 ?x . }\n  UNION\n  { ?s ex:p3 ?y . FILTER(?y < "
						+ filterLimit + ") }\n}"));

		return cases;
	}
}
